<!DOCTYPE html><html lang="en"><head><script type="importmap">{"imports":{"2RfBo":"/kkwak.8288312c.png","3AI0W":"/Box2D.368c577c.wasm","4ZtA3":"/ff.f22e3cf2.svg","5TMa2":"/junyoop.1200c7a5.png","5mBqN":"/kubin.860ce731.png","8OvAP":"/Box2D.simd.75bf81fb.wasm","aspIg":"/Box2D.a070c79d.js","g6HnH":"/Box2D.simd.7cdb49ce.js","kCzMz":"/chamru.192d6726.png"}}</script>
  <base href="/roulette-multiplayer/">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5899C1DJM0"></script>

  <title>Marble Roulette</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.2f316c01.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.3597a0fa.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.38143b41.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.c2eb0cfb.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.482241b6.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.721e3998.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.15b26ac4.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.c70b6780.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.1c38e27c.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.778fbd46.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.09fde066.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.b27ae6bd.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.c68c989a.png">
  <link rel="manifest" href="/assets/manifest.webmanifest">

  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.8429dbf3.png">
  <meta name="theme-color" content="#ffffff">

  <meta name="description" content="A lucky draw by dropping marbles, made by lazygyu">
  <meta property="og:url" content="https://lazygyu.github.io/roulette/">
  <meta property="og:title" content="Marble Roulette">
  <meta property="og:description" content="A lucky draw by dropping marbles, made by lazygyu">
  <meta property="og:site_name" content="lazygyu.github.io">
  <meta property="og:type" content="website">

  <link rel="stylesheet" href="/roulette.72fc1a99.css">
</head>
<body>
<script type="module" src="/roulette.34df32e0.js"></script>
<script type="text/javascript">window.dataLayer = window.dataLayer || [];
function gtag() {
    dataLayer.push(arguments);
}
gtag('js', new Date());
gtag('config', 'G-5899C1DJM0');
function getNames() {
    const value = document.querySelector('#in_names').value.trim();
    return value.split(/[,\r\n]/g).map((v)=>v.trim()).filter((v)=>!!v);
}
function parseName(nameStr) {
    const weightRegex = /(\/\d+)/;
    const countRegex = /(\*\d+)/;
    const hasWeight = weightRegex.test(nameStr);
    const hasCount = countRegex.test(nameStr);
    const name = /^\s*([^\/*]+)?/.exec(nameStr)[1];
    const weight = hasWeight ? parseInt(weightRegex.exec(nameStr)[1].replace('/', '')) : 1;
    const count = hasCount ? parseInt(countRegex.exec(nameStr)[1].replace('*', '')) : 1;
    return {
        name,
        weight,
        count
    };
}
function getReady() {
    const names = getNames();
    window.roulette.setMarbles(names);
    ready = names.length > 0;
    localStorage.setItem('mbr_names', names.join(','));
    switch(winnerType){
        case 'first':
            setWinnerRank(1);
            break;
        case 'last':
            const total = window.roulette.getCount();
            setWinnerRank(total);
            break;
    }
}
function setWinnerRank(rank) {
    document.querySelector('#in_winningRank').value = rank;
    window.options.winningRank = rank - 1;
    window.roulette.setWinningRank(window.options.winningRank);
    if (winnerType === 'first') {
        document.querySelector('.btn-first-winner').classList.toggle('active', true);
        document.querySelector('.btn-last-winner').classList.toggle('active', false);
        document.querySelector('#in_winningRank').classList.toggle('active', false);
    } else if (winnerType === 'last') {
        document.querySelector('.btn-first-winner').classList.toggle('active', false);
        document.querySelector('.btn-last-winner').classList.toggle('active', true);
        document.querySelector('#in_winningRank').classList.toggle('active', false);
    } else if (winnerType === 'custom') {
        document.querySelector('.btn-first-winner').classList.toggle('active', false);
        document.querySelector('.btn-last-winner').classList.toggle('active', false);
        document.querySelector('#in_winningRank').classList.toggle('active', true);
    }
}
let ready = false;
let winnerType = 'first';
document.addEventListener('DOMContentLoaded', ()=>{
    initialize();
});
function initialize() {
    if (!window.roulette || !window.roulette.isReady) {
        console.log('does not loaded yet');
        setTimeout(initialize, 100);
        return;
    }
    console.log('initializing start');
    const savedNames = localStorage.getItem('mbr_names');
    if (savedNames) document.querySelector('#in_names').value = savedNames;
    document.querySelector('#in_names').addEventListener('input', ()=>{
        getReady();
    });
    document.querySelector('#in_names').addEventListener('blur', ()=>{
        const nameSource = getNames();
        const nameSet = new Set();
        const nameCounts = {};
        nameSource.forEach((nameSrc)=>{
            const name = parseName(nameSrc);
            const key = name.weight > 1 ? `${name.name}/${name.weight}` : name.name;
            if (!nameSet.has(key)) {
                nameSet.add(key);
                nameCounts[key] = 0;
            }
            nameCounts[key] += name.count;
        });
        const result = [];
        Object.keys(nameCounts).forEach((key)=>{
            if (nameCounts[key] > 1) result.push(`${key}*${nameCounts[key]}`);
            else result.push(key);
        });
        const oldValue = document.querySelector('#in_names').value;
        const newValue = result.join(',');
        if (oldValue !== newValue) {
            document.querySelector('#in_names').value = newValue;
            getReady();
        }
    });
    document.querySelector('#btnShuffle').addEventListener('click', ()=>{
        getReady();
    });
    // ë¹¨ë¦¬ê°ê¸° ìƒíƒœ ê°ì‹œ (ë©€í‹°í”Œë ˆì´ì–´ìš©)
    let lastFastForwardState = false;
    setInterval(()=>{
        if (window.multiplayerUI && window.multiplayerUI.getRoomManager().getRoomId()) {
            const roomManager = window.multiplayerUI.getRoomManager();
            const gameSync = window.multiplayerUI.getGameSync();
            if (roomManager.getIsHost()) {
                const fastForwarder = window.roulette.getFastForwarder();
                const currentState = fastForwarder.getEnabled();
                if (currentState !== lastFastForwardState) {
                    lastFastForwardState = currentState;
                    gameSync.setFastForward(currentState);
                }
            }
        }
    }, 100);
    document.querySelector('#btnStart').addEventListener('click', ()=>{
        if (!ready) return;
        gtag && gtag('event', 'start', {
            'event_category': 'roulette',
            'event_label': 'start',
            'value': window.roulette.getCount()
        });
        // ë©€í‹°í”Œë ˆì´ì–´ ëª¨ë“œì¸ ê²½ìš° GameSyncë¥¼ í†µí•´ ì‹œì‘
        if (window.multiplayerUI && window.multiplayerUI.getRoomManager().getRoomId()) {
            const roomManager = window.multiplayerUI.getRoomManager();
            const gameSync = window.multiplayerUI.getGameSync();
            // í˜¸ìŠ¤íŠ¸ë§Œ ê²Œì„ ì‹œì‘ ê°€ëŠ¥
            if (roomManager.getIsHost()) {
                // ëª¨ë“  ì°¸ê°€ìê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (!roomManager.areAllPlayersReady()) {
                    alert("\uBAA8\uB4E0 \uCC38\uAC00\uC790\uAC00 \uC900\uBE44\uB420 \uB54C\uAE4C\uC9C0 \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.");
                    return;
                }
                // ê²Œì„ ì„¤ì • ìˆ˜ì§‘ - ì°¸ê°€ì ì´ë¦„ë“¤ì„ êµ¬ìŠ¬ë¡œ ì‚¬ìš©
                const players = roomManager.getPlayers();
                const names = players.map((player)=>player.name);
                const mapIndex = parseInt(document.querySelector('#sltMap').value);
                const winnerRank = window.options.winningRank;
                console.log("[MultiplayerMode] \uAC8C\uC784 \uC2DC\uC791:", names, mapIndex, winnerRank);
                // GameSyncë¥¼ í†µí•´ ê²Œì„ ì‹œì‘ (ëª¨ë“  ì°¸ê°€ìì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸)
                // GameSyncê°€ ì•Œì•„ì„œ í˜¸ìŠ¤íŠ¸ë„ ê²Œì„ì„ ì‹œì‘í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” return
                gameSync.startGame(names, mapIndex, winnerRank);
                // UI ìˆ¨ê¸°ê¸°ëŠ” GameSyncì˜ gameStart ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬ë¨
                return;
            } else {
                alert("\uD638\uC2A4\uD2B8\uB9CC \uAC8C\uC784\uC744 \uC2DC\uC791\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4.");
                return;
            }
        }
        // ì‹±ê¸€í”Œë ˆì´ì–´ ëª¨ë“œ
        window.roulette.start();
        document.querySelector('#settings').classList.add('hide');
    });
    document.querySelector('#chkAutoRecording').addEventListener('change', (e)=>{
        window.options.autoRecording = e.target.matches(':checked');
        window.roulette.setAutoRecording(window.options.autoRecording);
    });
    document.querySelector('#chkSkill').addEventListener('change', (e)=>{
        window.options.useSkills = e.target.matches(':checked');
        window.roulette.setWinningRank(window.options.winningRank);
    });
    document.querySelector('#in_winningRank').addEventListener('change', (e)=>{
        const v = parseInt(e.target.value, 10);
        winnerType = 'custom';
        setWinnerRank(isNaN(v) ? 0 : v);
    });
    document.querySelector('.btn-last-winner').addEventListener('click', ()=>{
        const total = window.roulette.getCount();
        winnerType = 'last';
        setWinnerRank(total);
    });
    document.querySelector('.btn-first-winner').addEventListener('click', ()=>{
        winnerType = 'first';
        setWinnerRank(1);
    });
    document.querySelector('#btnShake').addEventListener('click', ()=>{
        window.roulette.shake();
        gtag('event', 'shake', {
            'event_category': 'roulette',
            'event_label': 'shake',
            'value': 1
        });
    });
    window.roulette.addEventListener('goal', (e)=>{
        // ë©€í‹°í”Œë ˆì´ì–´ ëª¨ë“œ ì²´í¬
        if (window.multiplayerUI && window.multiplayerUI.getRoomManager().getRoomId()) {
            const roomManager = window.multiplayerUI.getRoomManager();
            const gameSync = window.multiplayerUI.getGameSync();
            const fromHost = e.detail.fromHost || false;
            if (roomManager.getIsHost()) {
                // í˜¸ìŠ¤íŠ¸ë§Œ ê²Œì„ ì¢…ë£Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
                const winner = e.detail.winner;
                const allPlayers = roomManager.getPlayers().map((p)=>p.name);
                console.log("[Multiplayer] \uD638\uC2A4\uD2B8\uAC00 \uAC8C\uC784 \uC885\uB8CC \uBE0C\uB85C\uB4DC\uCE90\uC2A4\uD2B8:", winner);
                gameSync.endGame([
                    winner
                ], allPlayers);
                // í˜¸ìŠ¤íŠ¸ UI ì²˜ë¦¬
                ready = false;
                setTimeout(()=>{
                    document.querySelector('#settings').classList.remove('hide');
                }, 3000);
            } else if (fromHost) {
                // ì°¸ê°€ìê°€ í˜¸ìŠ¤íŠ¸ë¡œë¶€í„° ë°›ì€ ê²°ê³¼ ì²˜ë¦¬
                console.log("[Multiplayer] \uCC38\uAC00\uC790 - \uD638\uC2A4\uD2B8 \uACB0\uACFC \uC218\uC2E0:", e.detail.winner);
                // ì°¸ê°€ì UI ì²˜ë¦¬
                ready = false;
                setTimeout(()=>{
                    document.querySelector('#settings').classList.remove('hide');
                }, 3000);
            } else {
                // ì°¸ê°€ìì˜ ìì²´ ë¬¼ë¦¬ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ëŠ” ë¬´ì‹œ
                console.log("[Multiplayer] \uCC38\uAC00\uC790 - \uC790\uCCB4 \uACB0\uACFC \uBB34\uC2DC (\uD638\uC2A4\uD2B8 \uACB0\uACFC \uB300\uAE30 \uC911)");
                return;
            }
        } else {
            // ì‹±ê¸€í”Œë ˆì´ì–´ ëª¨ë“œ
            ready = false;
            setTimeout(()=>{
                document.querySelector('#settings').classList.remove('hide');
            }, 3000);
        }
    });
    window.roulette.addEventListener('shakeAvailableChanged', (e)=>{
        document.querySelector('#inGame').classList.toggle('hide', !e.detail);
    });
    window.roulette.addEventListener('message', (e)=>{
        simpleToast(e.detail);
    });
    document.querySelector('#btnShuffle').click();
    const maps = window.roulette.getMaps();
    const mapSelector = document.querySelector('#sltMap');
    maps.forEach((map)=>{
        const option = document.createElement('option');
        option.value = map.index;
        option.innerHTML = map.title;
        option.setAttribute('data-trans', '');
        window.translateElement(option);
        mapSelector.append(option);
    });
    mapSelector.addEventListener('change', (e)=>{
        const index = e.target.value;
        window.roulette.setMap(index);
    });
    function simpleToast(msg) {
        const toast = document.createElement('div');
        toast.classList.add('toast');
        toast.innerHTML = msg;
        if (window.translateElement) {
            console.log('try to translate');
            window.translateElement(toast);
        }
        document.body.appendChild(toast);
        setTimeout(()=>{
            document.body.removeChild(toast);
        }, 1200);
    }
}

</script>
<div id="settings" class="settings">
  <div class="right">
    <div class="row">
      <label>
        <i class="icon map"></i>
        <span data-trans="">Map</span>
      </label>
      <select id="sltMap"></select>
    </div>
    <div class="row">
      <label>
        <i class="icon record"></i>
        <span data-trans="">Recording</span>
      </label>
      <input type="checkbox" id="chkAutoRecording">
    </div>
    <div class="row">
      <label>
        <i class="icon trophy"></i>
        <span data-trans="">The winner is</span>
      </label>
      <div class="btn-group">
        <button class="btn-winner btn-first-winner active" data-trans="">First</button>
        <button class="btn-winner btn-last-winner" data-trans="">Last</button>
        <input type="number" id="in_winningRank" value="1" min="1">
      </div>
    </div>
    <div class="row">
      <label>
        <i class="icon bomb"></i>
        <span data-trans="">Using skills</span>
      </label>
      <input type="checkbox" id="chkSkill" checked="">
    </div>
  </div>
  <div class="left">
    <h3 data-trans="">Enter names below</h3>
    <textarea id="in_names" placeholder="Input names separated by commas or line feed here" data-trans="placeholder">ì§±êµ¬*5, ì§±ì•„*10, ë´‰ë¯¸ì„ *3</textarea>
    <div class="actions">
      <button id="mp-create-room-btn" class="mp-btn">
        <span>ğŸ  ë°© ë§Œë“¤ê¸°</span>
      </button>
      <button id="mp-join-room-btn" class="mp-btn">
        <span>ğŸšª ë°© ì°¸ê°€í•˜ê¸°</span>
      </button>
      <div class="sep"></div>
      <button id="btnShuffle">
        <i class="icon shuffle"></i>
        <span data-trans="">Shuffle</span>
      </button>
      <button id="btnStart">
        <i class="icon play"></i>
        <span data-trans="">Start</span>
      </button>
    </div>
  </div>
</div>
<div id="inGame" class="settings hide">
  <button id="btnShake" data-trans="">Shake!</button>
</div>
<!-- ë©€í‹°í”Œë ˆì´ì–´ ëª¨ë‹¬ -->
<div id="mp-modal" class="mp-modal" style="display: none">
  <div class="mp-modal-content">
    <h2 id="mp-modal-title"></h2>
    <div id="mp-modal-content"></div>
  </div>
</div>

<!-- ë©€í‹°í”Œë ˆì´ì–´ ë£¸ íŒ¨ë„ -->
<div id="mp-room-panel" class="mp-room-panel" style="display: none">
  <div class="mp-room-header">
    <h3>ğŸ® ë©€í‹°í”Œë ˆì´ì–´</h3>
    <div class="mp-room-code-container">
      <span>ë°© ì½”ë“œ:</span>
      <span id="mp-room-code-display" class="mp-room-code"></span>
      <button id="mp-copy-room-code" class="mp-btn-copy">ğŸ“‹ ë³µì‚¬</button>
    </div>
  </div>
  <div class="mp-player-list-container">
    <h4>ì°¸ê°€ì ëª©ë¡</h4>
    <div id="mp-player-list" class="mp-player-list"></div>
  </div>
  <div class="mp-room-actions">
    <button id="mp-change-name-btn" class="mp-btn-secondary" style="display: inline-block">ì´ë¦„ ë³€ê²½</button>
    <button id="mp-ready-btn" class="mp-btn-primary" style="display: none">ì¤€ë¹„</button>
    <button id="mp-leave-room-btn" class="mp-btn-secondary" style="display: none">ë‚˜ê°€ê¸°</button>
  </div>
</div>
<div class="copyright">Â© 2022-2025.<a href="https://lazygyu.net" target="_blank">lazygyu</a> <span data-trans="">This program is freeware and may be used freely anywhere, including in broadcasts and videos.</span>
</div>


</body></html>