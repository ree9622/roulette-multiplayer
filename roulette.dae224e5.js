let e;function t(e,t,i,s){Object.defineProperty(e,t,{get:i,set:s,enumerable:!0,configurable:!0})}function i(e){return e&&e.__esModule?e.default:e}var s,o,r,n,a,c,p,l,h,d,y=globalThis,u={},f={},g=y.parcelRequire5cc2;null==g&&((g=function(e){if(e in u)return u[e].exports;if(e in f){var t=f[e];delete f[e];var i={id:e,exports:{}};return u[e]=i,t.call(i.exports,i,i.exports),i.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){f[e]=t},y.parcelRequire5cc2=g);var m=g.register;m("iyjrR",function(e,t){e.exports=import("8BShk").then(()=>g("jaZ7o"))}),m("8ZFBQ",function(e,t){e.exports=import("ilUZb").then(()=>g("6fGU3"))});const b={en:{"Enter names below":"Enter names below",Shuffle:"Shuffle",Start:"Start",Map:"Map",Recording:"Recording","The winner is":"The winner is","Using skills":"Using skills",First:"First",Last:"Last","Wheel of fortune":"Wheel of fortune",BubblePop:"BubblePop","Pot of greed":"Pot of greed","Yoru ni Kakeru":"Into The Night (by item4)","Shake!":"Shake!","Input names separated by commas or line feed here":"Input names separated by commas or line feed here","This program is freeware and may be used freely anywhere, including in broadcasts and videos.":"This program is freeware and may be used freely anywhere, including in broadcasts and videos.",Close:"Close","The result has been copied":"The result has been copied"},ko:{"Enter names below":"이름들을 입력하세요",Shuffle:"섞기",Start:"시작",Map:"맵",Recording:"녹화","The winner is":"당첨 순위","Using skills":"스킬 활성화",First:"첫번째",Last:"마지막","Wheel of fortune":"운명의 수레바퀴",BubblePop:"버블팝","Pot of greed":"욕망의 항아리","Yoru ni Kakeru":"밤을 달리다 (by item4)","Shake!":"흔들기!","Input names separated by commas or line feed here":"이름들을 쉼표나 엔터로 구분해서 넣어주세요","This program is freeware and may be used freely anywhere, including in broadcasts and videos.":"이 프로그램은 프리웨어이며 방송이나 영상 등을 포함한 어떤 용도로든 자유롭게 사용하는 것이 허용되어있습니다.",Close:"닫기","The result has been copied":"결과가 복사되었습니다"}};function x(t){if(!(t instanceof HTMLElement)||!e)return;let i=t.getAttribute("data-trans");if(i){let s=(t.getAttribute(i)||"").trim();s&&s in b[e]&&t.setAttribute(i,b[e][s])}else{let i=t.innerText.trim();i&&i in b[e]&&(t.innerText=b[e][i])}}function _(e,t,i,s){var o,r=arguments.length,n=r<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(r<3?o(n):r>3?o(t,i,n):o(t,i))||n);return r>3&&n&&Object.defineProperty(t,i,n),n}document.addEventListener("DOMContentLoaded",()=>{console.log("localization loaded");let t=navigator.language.split("-")[0];console.log("detected locale: ",t),function(t){if(t===e)return;document.documentElement.lang=t;let i=t.toLocaleLowerCase();e=i in b?i:"en",document.querySelectorAll("[data-trans]").forEach(x)}(t)}),window.translateElement=x,"function"==typeof SuppressedError&&SuppressedError;var w=((s={})[s.None=0]="None",s[s.Impact=1]="Impact",s);const v={box:"cyan",circle:"yellow",polyline:"white"},C={box:"cyan",circle:"yellow",polyline:"cyan"};function S(e){return Math.PI*e/180}function k(e,t){let i=e.exec(t);return i?i[1]:""}function E(e){return e.toString().padStart(2,"0")}const R=new class{constructor(){this.useSkills=!0,this.winningRank=0,this.autoRecording=!0}};class T{static sub(e,t){return{x:t.x-e.x,y:t.y-e.y}}static lenSq(e){return e.x*e.x+e.y*e.y}static len(e){return Math.sqrt(this.lenSq(e))}static mul(e,t){return{x:e.x*t,y:e.y*t}}static add(e,t){return{x:e.x+t.x,y:e.y+t.y}}}class P{get position(){return this.physics.getMarblePosition(this.id)||{x:0,y:0,angle:0}}get x(){return this.position.x}set x(e){this.position.x=e}get y(){return this.position.y}set y(e){this.position.y=e}get angle(){return this.position.angle}constructor(e,t,i,s,o=1){this.type="marble",this.name="",this.size=.5,this.color="red",this.hue=0,this.impact=0,this.weight=1,this.skill=w.None,this.isActive=!1,this._skillRate=5e-4,this._coolTime=5e3,this._maxCoolTime=5e3,this._stuckTime=0,this.lastPosition={x:0,y:0},this.name=s||`M${t}`,this.weight=o,this.physics=e,this._maxCoolTime=1e3+(1-this.weight)*4e3,this._coolTime=this._maxCoolTime*Math.random(),this._skillRate=.2*this.weight;let r=Math.ceil(i/10),n=Math.floor(t/10),a=-Math.max(0,Math.ceil(r-5));this.hue=360/i*t,this.color=`hsl(${this.hue} 100% 70%)`,this.id=t,e.createMarble(t,10.25+t%10*.6,r-n+a)}update(e){this.isActive&&1e-5>T.lenSq(T.sub(this.lastPosition,this.position))?(this._stuckTime+=e,this._stuckTime>5e3&&(this.physics.shakeMarble(this.id),this._stuckTime=0)):this._stuckTime=0,this.lastPosition={x:this.position.x,y:this.position.y},this.skill=w.None,this.impact&&(this.impact=Math.max(0,this.impact-e)),this.isActive&&R.useSkills&&this._updateSkillInformation(e)}_updateSkillInformation(e){this._coolTime>0&&(this._coolTime-=e),this._coolTime<=0&&(this.skill=Math.random()<this._skillRate?w.Impact:w.None,this._coolTime=this._maxCoolTime)}render(e,t,i,s=!1,o,r){let n=r.w/r.zoom/2,a=r.h/r.zoom/2,c=r.x-n,p=r.x+n,l=r.y-a-this.size/2,h=r.y+a;if(!s&&(this.x<c||this.x>p||this.y<l||this.y>h))return;let d=e.getTransform();s?this._renderMinimap(e):this._renderNormal(e,t,i,o),e.setTransform(d)}_renderMinimap(e){e.fillStyle=this.color,this._drawMarbleBody(e,!0)}_drawMarbleBody(e,t){e.beginPath(),e.arc(this.x,this.y,t?this.size:this.size/2,0,2*Math.PI),e.fill()}_renderNormal(e,t,i,s){let o=this.size/2;this._stuckTime>0?e.fillStyle=`hsl(${this.hue} 100% ${70+25*Math.min(1,this._stuckTime/5e3)}%`:e.fillStyle=`hsl(${this.hue} 100% ${70+25*Math.min(1,this.impact/500)}%`,s?(e.translate(this.x,this.y),e.rotate(this.angle),e.drawImage(s,-o,-o,2*o,2*o),e.rotate(-this.angle),e.translate(-this.x,-this.y)):this._drawMarbleBody(e,!1),e.shadowColor="",e.shadowBlur=0,this._drawName(e,t),i&&this._drawOutline(e,2/t),R.useSkills&&this._renderCooltime(e,t)}_drawName(e,t){e.font=`${12/t}pt sans-serif`,e.strokeStyle="black",e.lineWidth=2/t,e.fillStyle=this.color,e.shadowBlur=0,e.strokeText(this.name,this.x,this.y+.25),e.fillText(this.name,this.x,this.y+.25)}_drawOutline(e,t){e.beginPath(),e.strokeStyle="white",e.lineWidth=t,e.arc(this.x,this.y,this.size/2,0,2*Math.PI),e.stroke()}_renderCooltime(e,t){e.strokeStyle="red",e.lineWidth=1/t,e.beginPath(),e.arc(this.x,this.y,this.size/2+2/t,S(270),S(270+360*this._coolTime/this._maxCoolTime)),e.stroke()}}class M{constructor(e,t){this._elapsed=0,this.position={x:0,y:0},this.force={x:0,y:0},this.color="",this.isDestroy=!1,this.position.x=e,this.position.y=t;let i=250*Math.random(),s=S(90*Math.random()-180),o=Math.cos(s)*i,r=Math.sin(s)*i;this.color=`hsl(${360*Math.random()} 50% 50%)`,this.force={x:o,y:r}}update(e){this._elapsed+=e;let t=T.mul(this.force,e/100);this.position=T.add(this.position,t),this.force.y+=10*e/100,this._elapsed>3e3&&(this.isDestroy=!0)}render(e){e.save(),e.globalAlpha=1-Math.pow(this._elapsed/3e3,2),e.fillStyle=this.color,e.fillRect(this.position.x,this.position.y,20,20),e.restore()}}class I{update(e){this._particles.forEach(t=>{t.update(e)}),this._particles=this._particles.filter(e=>!e.isDestroy)}render(e){this._particles.forEach(t=>t.render(e))}shot(e,t){for(let i=0;i<200;i++)this._particles.push(new M(e,t))}constructor(){this._particles=[]}}const V=[{title:"Wheel of fortune",goalY:111,zoomY:106.75,entities:[{position:{x:0,y:0},shape:{type:"polyline",points:[[16.5,-300],[9.25,-300],[9.25,8.5],[2,19.25],[2,26],[9.75,30],[9.75,33.5],[1.25,41],[1.25,53.75],[8.25,58.75],[8.25,63],[9.25,64],[8.25,65],[8.25,99.25],[15.1,106.75],[15.1,111.75]],rotation:0},type:"static",props:{density:1,angularVelocity:0,restitution:0}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[16.5,-300],[16.5,9.25],[9.5,20],[9.5,22.5],[17.5,26],[17.5,33.5],[24,38.5],[19,45.5],[19,55.5],[24,59.25],[24,63],[23,64],[24,65],[24,100.5],[16,106.75],[16,111.75]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[12.75,37.5],[7,43.5],[7,49.75],[12.75,53.75],[12.75,37.5]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[14.75,37.5],[14.75,43],[17.5,40.25],[14.75,37.5]]}},{position:{x:15.5,y:30},shape:{type:"box",width:.2,height:.2,rotation:-45},type:"static",props:{density:1,angularVelocity:0,restitution:1}},{position:{x:15.5,y:32},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.5,y:28},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:30},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:32},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:28},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.4,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11.3,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13.2,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.1,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:17,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:18.9,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:20.699999999999996,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:22.7,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.4,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11.3,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13.2,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.1,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:17,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:18.9,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:20.699999999999996,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:22.7,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.5,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.75,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:16,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:19.25,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:22.5,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11,y:95},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14.25,y:95},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:17.5,y:95},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:20.75,y:95},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.5,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.75,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:16,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:19.25,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:22.5,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:8,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3.5,restitution:0}},{position:{x:12,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-3.5,restitution:0}},{position:{x:16,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3.5,restitution:0}},{position:{x:20,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-3.5,restitution:0}},{position:{x:24,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3.5,restitution:0}},{position:{x:14,y:106.75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-1.2,restitution:0}}]},{title:"BubblePop",goalY:83,zoomY:78,entities:[{type:"static",position:{x:10.375,y:-108.5},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[6.125,-191.5],[-1.125,-191.5],[-1.125,108.5],[-1.125,151.5],[-6.125,158.5],[-1.125,161.5],[-1.125,179.5],[-.9128679656440362,179.7498817789222],[-1.125,179.9997635578444],[-1.125,183.5],[1.625,188.5],[1.625,191.5]]}},{type:"static",position:{x:16.25,y:-108.5},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[.25,-191.5],[.25,158.5],[3.25,162.5],[2.25,164.5],[3.25,166.5],[.25,169.5],[.25,179.5],[.03786796564403616,179.75925677892224],[.25,179.9997635578444],[.25,183.5],[-3.25,188.5],[-3.25,191.5]]}},{type:"static",position:{x:16.5,y:55.75},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[0,-3.25],[1,-1.75],[0,.25],[1,2.25],[0,3.25],[-1,.25],[0,-3.25]]}},{type:"static",position:{x:10.375,y:48.25},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[-1.125,-2.75],[-4.125,1.25],[-1.125,2.75],[4.125,2.25],[-1.125,-2.75]]}},{type:"static",position:{x:10.15625,y:26.75},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[-.90625,-.75],[.90625,.75]]}},{type:"static",position:{x:15.59375,y:26.75},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[.90625,-.75],[-.90625,.75]]}},{type:"static",position:{x:12.875,y:29.25},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[-1.8125,.75],[0,-.75],[1.8125,.75]]}},{type:"static",position:{x:10.15625,y:31.75},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[-.90625,-.75],[.90625,.75]]}},{type:"static",position:{x:15.59375,y:31.75},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[.90625,-.75],[-.90625,.75]]}},{type:"static",position:{x:12.875,y:34.25},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"polyline",rotation:0,points:[[-1.8125,.75],[0,-.75],[1.8125,.75]]}},{type:"static",position:{x:9.25,y:18},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:11.25,y:18},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:13.25,y:18},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:15.25,y:18},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:10.5,y:19},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:12.5,y:19},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:14.5,y:19},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:16.5,y:19},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:9.25,y:20},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:11.25,y:20},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:13.25,y:20},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:15.25,y:20},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:10.5,y:21},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:12.5,y:21},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:14.5,y:21},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:16.5,y:21},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:9.25,y:22},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:11.25,y:22},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:13.25,y:22},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:15.25,y:22},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:10.5,y:23},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:12.5,y:23},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:14.5,y:23},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:16.5,y:23},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:.15,height:.15}},{type:"static",position:{x:9.400000000000002,y:39},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:3,height:3}},{type:"static",position:{x:16.5,y:43},props:{angularVelocity:0,density:1,restitution:0},shape:{type:"box",rotation:.7853981633974483,width:3,height:3}},{type:"kinematic",position:{x:10.7,y:10},props:{angularVelocity:10,density:1,restitution:0},shape:{type:"box",rotation:0,width:.5,height:.1}},{type:"kinematic",position:{x:14.7,y:10},props:{angularVelocity:-10,density:1,restitution:0},shape:{type:"box",rotation:0,width:.5,height:.1}},{type:"kinematic",position:{x:12.7,y:10},props:{angularVelocity:10,density:1,restitution:0},shape:{type:"box",rotation:0,width:.5,height:.1}},{type:"kinematic",position:{x:10.7,y:14},props:{angularVelocity:-3,density:1,restitution:0},shape:{type:"box",rotation:0,width:2,height:.1}},{type:"kinematic",position:{x:14.7,y:14},props:{angularVelocity:3,density:1,restitution:0},shape:{type:"box",rotation:0,width:2,height:.1}},{type:"kinematic",position:{x:11.2,y:44},props:{angularVelocity:-5,density:1,restitution:0},shape:{type:"box",rotation:0,width:.5,height:.1}},{type:"kinematic",position:{x:10.3,y:75},props:{angularVelocity:8,density:1,restitution:0},shape:{type:"box",rotation:0,width:1,height:.1}},{type:"kinematic",position:{x:15.462132034355964,y:75},props:{angularVelocity:-8,density:1,restitution:0},shape:{type:"box",rotation:0,width:1,height:.1}},{type:"static",position:{x:11,y:65},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}},{type:"static",position:{x:13,y:65},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}},{type:"static",position:{x:15,y:65},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}},{type:"static",position:{x:12,y:67.5},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}},{type:"static",position:{x:14,y:67.5},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}},{type:"static",position:{x:13,y:69.77058813837772},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.8}},{type:"static",position:{x:10.7,y:77.5},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.8}},{type:"static",position:{x:14.7,y:77.5},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.8}},{type:"static",position:{x:12.625,y:80},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:1.5}},{type:"static",position:{x:12.625,y:80},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:1.2}},{type:"kinematic",position:{x:12.625,y:56.00000000000001},props:{angularVelocity:-8,density:1,restitution:0},shape:{type:"box",rotation:0,width:1,height:.1}},{type:"static",position:{x:9.947604593262161,y:62.59581680393866},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}},{type:"static",position:{x:11.947604593262161,y:62.59581680393866},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}},{type:"static",position:{x:13.947604593262161,y:62.59581680393866},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}},{type:"static",position:{x:15.828283102570442,y:62.59581680393866},props:{angularVelocity:0,density:1,restitution:1.5,life:1},shape:{type:"circle",radius:.5}}]},{title:"Pot of greed",goalY:111,zoomY:110,entities:[{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[17,-300],[9,-300],[9,8.5],[2,15],[6,61.5]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[7,71],[9,101],[8,100.5],[6,100],[5,90],[4,70],[7,71]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[17,-300],[17,8.5],[24,15],[20,61.5]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[19,71],[17,101],[18,100.5],[20,100],[21,90],[22,70],[19,71]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[11,88],[12,90],[12,112]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[15,88],[14,90],[14,112]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[12,102],[11,103],[9,104],[8,104],[6,103],[5,102],[4,100],[3,90],[2,70],[3,65],[4,63],[5,62],[6,61.5]]}},{type:"static",position:{x:0,y:0},props:{density:1,angularVelocity:0,restitution:0},shape:{type:"polyline",rotation:0,points:[[14,102],[15,103],[17,104],[18,104],[20,103],[21,102],[22,100],[23,90],[24,70],[23,65],[22,63],[21,62],[20,61.5]]}},{position:{x:13,y:20},type:"static",shape:{type:"box",width:3,height:3,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13,y:55},type:"static",shape:{type:"box",width:3,height:3,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:8,y:37},type:"static",shape:{type:"box",width:2,height:2,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:18,y:37},type:"static",shape:{type:"box",width:2,height:2,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11,y:12},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-3,restitution:0}},{position:{x:15,y:12},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3,restitution:0}},{position:{x:8,y:104},type:"kinematic",shape:{type:"box",width:1,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:6,y:103},type:"kinematic",shape:{type:"box",width:1.5,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:4,y:100},type:"kinematic",shape:{type:"box",width:1.5,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:3.5,y:95},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:3,y:90},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:2.75,y:85},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:2.5,y:80},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:2.25,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:2,y:70},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:18,y:104},type:"kinematic",shape:{type:"box",width:1,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:20,y:103},type:"kinematic",shape:{type:"box",width:1.5,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:22,y:100},type:"kinematic",shape:{type:"box",width:1.5,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:22.5,y:95},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:23,y:90},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:23.25,y:85},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:23.5,y:80},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:23.75,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:24,y:70},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}}]},{title:"Yoru ni Kakeru",goalY:248,zoomY:234.5,entities:[{position:{x:2,y:0},shape:{type:"box",width:1,height:800,rotation:0,color:"#222",bloomColor:"#777"},type:"static",props:{density:500,angularVelocity:0,restitution:0}},{type:"static",position:{x:21,y:0},props:{density:500,angularVelocity:0,restitution:0},shape:{type:"box",rotation:0,width:1,height:800,color:"#222",bloomColor:"#777"}},{position:{x:4,y:25},shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},type:"static",props:{density:1,angularVelocity:0,restitution:1}},{position:{x:4,y:30},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:4,y:35},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:4,y:40},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9,y:25},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9,y:30},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9,y:35},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9,y:40},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14,y:25},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14,y:30},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14,y:35},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14,y:40},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:19,y:25},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:19,y:30},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:19,y:35},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:19,y:40},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45,color:"#818fb4"},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:6.5,y:27.5},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0,color:"#9bec00"},props:{density:1,angularVelocity:2,restitution:0}},{position:{x:6.5,y:37.5},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0,color:"#ff6868"},props:{density:1,angularVelocity:2,restitution:0}},{position:{x:11.5,y:32.5},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0,color:"#80b3ff"},props:{density:2,angularVelocity:4,restitution:0}},{position:{x:16.5,y:27.5},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0,color:"#ff6868"},props:{density:1,angularVelocity:-2,restitution:0}},{position:{x:16.5,y:37.5},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0,color:"#9bec00"},props:{density:1,angularVelocity:-2,restitution:0}},{position:{x:10,y:26},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:26},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:13,y:26},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:10,y:27.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:27.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:13,y:27.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:10,y:29},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:29},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:13,y:29},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:5,y:31},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:31},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:8,y:31},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:5,y:32.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:32.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:8,y:32.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:5,y:34},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:34},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:8,y:34},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:15,y:31},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:31},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:18,y:31},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:15,y:32.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:32.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:18,y:32.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:15,y:34},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:34},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:18,y:34},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:10,y:36},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:36},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:13,y:36},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:10,y:37.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:37.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:13,y:37.5},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:10,y:39},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:39},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:13,y:39},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:50},type:"kinematic",shape:{type:"box",width:6.5,height:.1,rotation:0,color:"#5c5470"},props:{density:1,angularVelocity:-2,restitution:0}},{position:{x:3.5,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:5,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:8,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:9.5,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:12.5,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:14,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:17,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:18.5,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:20,y:60},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:3,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:6,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:7.5,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:9,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:10.5,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:12,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:13.5,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:15,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:18,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:63},type:"static",shape:{type:"circle",radius:.5,color:"#ffe227"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:3.5,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:5,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:8,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:9.5,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:12.5,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:14,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:17,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:18.5,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:20,y:66},type:"static",shape:{type:"circle",radius:.5,color:"#fff4b7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:75},type:"kinematic",shape:{type:"box",width:4,height:.1,rotation:0,color:"#ff577f"},props:{density:1,angularVelocity:-4,restitution:0}},{position:{x:18.5,y:75},type:"kinematic",shape:{type:"box",width:4,height:.1,rotation:0,color:"#ff577f"},props:{density:1,angularVelocity:4,restitution:0}},{position:{x:3.8,y:90},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1,restitution:0}},{position:{x:19.2,y:90},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1,restitution:0}},{position:{x:5.8,y:92},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.2,restitution:0}},{position:{x:17.2,y:92},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.2,restitution:0}},{position:{x:7.8,y:94},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.4,restitution:0}},{position:{x:15.2,y:94},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.4,restitution:0}},{position:{x:9.8,y:96},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.6,restitution:0}},{position:{x:13.2,y:96},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.6,restitution:0}},{position:{x:3.8,y:94},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.2,restitution:0}},{position:{x:19.2,y:94},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.2,restitution:0}},{position:{x:5.8,y:96},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.4,restitution:0}},{position:{x:17.2,y:96},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.4,restitution:0}},{position:{x:7.8,y:98},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.6,restitution:0}},{position:{x:15.2,y:98},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.6,restitution:0}},{position:{x:9.8,y:100},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.8,restitution:0}},{position:{x:13.2,y:100},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.8,restitution:0}},{position:{x:10,y:90},type:"static",shape:{type:"circle",radius:.5,color:"#ffe3fe"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:12,y:90},type:"static",shape:{type:"circle",radius:.5,color:"#ffe3fe"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:8,y:92},type:"static",shape:{type:"circle",radius:.5,color:"#ffe3fe"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:14,y:92},type:"static",shape:{type:"circle",radius:.5,color:"#ffe3fe"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:6,y:94},type:"static",shape:{type:"circle",radius:.5,color:"#ffe3fe"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:16,y:94},type:"static",shape:{type:"circle",radius:.5,color:"#ffe3fe"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:4,y:96},type:"static",shape:{type:"circle",radius:.5,color:"#ffe3fe"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:18,y:96},type:"static",shape:{type:"circle",radius:.5,color:"#ffe3fe"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:10,y:94},type:"static",shape:{type:"circle",radius:.5,color:"#ff94cc"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:12,y:94},type:"static",shape:{type:"circle",radius:.5,color:"#ff94cc"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:8,y:96},type:"static",shape:{type:"circle",radius:.5,color:"#ff94cc"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:14,y:96},type:"static",shape:{type:"circle",radius:.5,color:"#ff94cc"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:6,y:98},type:"static",shape:{type:"circle",radius:.5,color:"#ff94cc"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:16,y:98},type:"static",shape:{type:"circle",radius:.5,color:"#ff94cc"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:4,y:100},type:"static",shape:{type:"circle",radius:.5,color:"#ff94cc"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:18,y:100},type:"static",shape:{type:"circle",radius:.5,color:"#ff94cc"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:100},type:"kinematic",shape:{type:"box",width:5,height:.1,rotation:0,color:"#5c8374"},props:{density:1,angularVelocity:-2.5,restitution:0}},{position:{x:18.5,y:100},type:"kinematic",shape:{type:"box",width:5,height:.1,rotation:0,color:"#5c8374"},props:{density:1,angularVelocity:2.5,restitution:0}},{position:{x:3.8,y:104},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.4,restitution:0}},{position:{x:19.2,y:104},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.4,restitution:0}},{position:{x:5.8,y:106},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.6,restitution:0}},{position:{x:17.2,y:106},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.6,restitution:0}},{position:{x:7.8,y:108},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.8,restitution:0}},{position:{x:15.2,y:108},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:1.8,restitution:0}},{position:{x:9.8,y:110},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:2,restitution:0}},{position:{x:13.2,y:110},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#c7ffd8"},props:{density:1,angularVelocity:2,restitution:0}},{position:{x:3.8,y:108},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.6,restitution:0}},{position:{x:19.2,y:108},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.6,restitution:0}},{position:{x:5.8,y:110},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.8,restitution:0}},{position:{x:17.2,y:110},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:1.8,restitution:0}},{position:{x:7.8,y:112},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:2,restitution:0}},{position:{x:15.2,y:112},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:2,restitution:0}},{position:{x:9.8,y:114},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:2.2,restitution:0}},{position:{x:13.2,y:114},type:"static",shape:{type:"box",width:.1,height:.1,rotation:-90,color:"#98ded9"},props:{density:1,angularVelocity:2.2,restitution:0}},{position:{x:3.5,y:105},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:105},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:3.5,y:107},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:107},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:107},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:107},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:3.5,y:109},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:109},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:109},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:109},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:7.5,y:109},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:109},type:"static",shape:{type:"circle",radius:.5,color:"#edeef7"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:115},type:"static",shape:{type:"circle",radius:.4,color:"#e6176d"},props:{angularVelocity:0,density:1,restitution:1.5,life:5}},{position:{x:17.5,y:115},type:"static",shape:{type:"circle",radius:.4,color:"#e6176d"},props:{angularVelocity:0,density:1,restitution:1.5,life:5}},{position:{x:5.5,y:115},type:"static",shape:{type:"circle",radius:1.2,color:"#e64588"},props:{angularVelocity:0,density:1,restitution:1.5,life:4}},{position:{x:17.5,y:115},type:"static",shape:{type:"circle",radius:1.2,color:"#e64588"},props:{angularVelocity:0,density:1,restitution:1.5,life:4}},{position:{x:5.5,y:115},type:"static",shape:{type:"circle",radius:2,color:"#e673a3"},props:{angularVelocity:0,density:1,restitution:1.5,life:3}},{position:{x:17.5,y:115},type:"static",shape:{type:"circle",radius:2,color:"#e673a3"},props:{angularVelocity:0,density:1,restitution:1.5,life:3}},{position:{x:5.5,y:115},type:"static",shape:{type:"circle",radius:2.8,color:"#e6a1bd"},props:{angularVelocity:0,density:1,restitution:1.5,life:2}},{position:{x:17.5,y:115},type:"static",shape:{type:"circle",radius:2.8,color:"#e6a1bd"},props:{angularVelocity:0,density:1,restitution:1.5,life:2}},{position:{x:5.5,y:115},type:"static",shape:{type:"circle",radius:3.8,color:"#e6cfd8"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:115},type:"static",shape:{type:"circle",radius:3.8,color:"#e6cfd8"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:120},type:"static",shape:{type:"circle",radius:.4,color:"#e6176d"},props:{angularVelocity:0,density:1,restitution:1.5,life:5}},{position:{x:11.5,y:120},type:"static",shape:{type:"circle",radius:1.2,color:"#e64588"},props:{angularVelocity:0,density:1,restitution:1.5,life:4}},{position:{x:11.5,y:120},type:"static",shape:{type:"circle",radius:2,color:"#e673a3"},props:{angularVelocity:0,density:1,restitution:1.5,life:3}},{position:{x:11.5,y:120},type:"static",shape:{type:"circle",radius:2.8,color:"#e6a1bd"},props:{angularVelocity:0,density:1,restitution:1.5,life:2}},{position:{x:11.5,y:120},type:"static",shape:{type:"circle",radius:3.8,color:"#e6cfd8"},props:{angularVelocity:0,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:130},type:"kinematic",shape:{type:"box",width:5,height:.1,rotation:0,color:"#435585"},props:{density:1,angularVelocity:.25,restitution:0}},{position:{x:18.5,y:130},type:"kinematic",shape:{type:"box",width:5,height:.1,rotation:0,color:"#5c8374"},props:{density:1,angularVelocity:-.32,restitution:0}},{position:{x:4.5,y:140},type:"kinematic",shape:{type:"box",width:4,height:.1,rotation:30,color:"#610c9f"},props:{density:1,angularVelocity:.32,restitution:0}},{position:{x:18.5,y:140},type:"kinematic",shape:{type:"box",width:4,height:.1,rotation:-30,color:"#872341"},props:{density:1,angularVelocity:-.32,restitution:0}},{position:{x:4.5,y:150},type:"kinematic",shape:{type:"box",width:5,height:.1,rotation:60,color:"#503c3c"},props:{density:1,angularVelocity:.32,restitution:0}},{position:{x:18.5,y:150},type:"kinematic",shape:{type:"box",width:5,height:.1,rotation:-60,color:"#5c5470"},props:{density:1,angularVelocity:-.32,restitution:0}},{position:{x:4.5,y:160},type:"kinematic",shape:{type:"box",width:4,height:.1,rotation:90,color:"#1a3636"},props:{density:1,angularVelocity:.32,restitution:0}},{position:{x:18.5,y:160},type:"kinematic",shape:{type:"box",width:4,height:.1,rotation:-90,color:"#522258"},props:{density:1,angularVelocity:-.32,restitution:0}},{position:{x:3.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:7.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:8.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:9.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:10.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:12.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:13.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:14.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:18.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:135},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:3.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:7.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:8.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:9.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:10.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:12.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:13.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:14.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:18.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:140},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:3.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:7.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:8.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:9.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:10.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:12.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:13.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:14.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:18.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:144},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:3.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:7.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:8.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:9.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:10.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:12.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:13.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:14.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:18.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:147},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:3.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:7.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:8.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:9.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:10.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:12.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:13.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:14.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:18.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:149},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:3.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:5.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:6.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:7.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:8.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:9.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:10.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:11.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:12.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:13.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:14.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:15.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:16.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:17.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:18.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:19.5,y:150},type:"static",shape:{type:"circle",radius:.2,color:"#e6e1ae"},props:{angularVelocity:1,density:1,restitution:1.5,life:1}},{position:{x:4.5,y:180},type:"kinematic",shape:{type:"box",width:6,height:.1,rotation:0,color:"#ccb1b1"},props:{density:1,angularVelocity:4.6,restitution:0}},{position:{x:18.5,y:180},type:"kinematic",shape:{type:"box",width:7,height:.1,rotation:0,color:"#b1ccb1"},props:{density:1,angularVelocity:-4,restitution:0}},{position:{x:11.5,y:195},type:"kinematic",shape:{type:"box",width:8,height:.1,rotation:0,color:"#b3ccff"},props:{density:1,angularVelocity:5.5,restitution:0}}]}];class D{get zoom(){return this._zoom}set zoom(e){this._targetZoom=e}get x(){return this._position.x}set x(e){this._targetPosition.x=e}get y(){return this._position.y}set y(e){this._targetPosition.y=e}get position(){return this._position}setPosition(e,t=!1){return t?this._position={x:e.x,y:e.y}:this._targetPosition={x:e.x,y:e.y}}lock(e){this._locked=e}startFollowingMarbles(){this._shouldFollowMarbles=!0}initializePosition(){this._position={x:12.95,y:2},this._targetPosition={x:12.95,y:2},this._shouldFollowMarbles=!1}update({marbles:e,stage:t,needToZoom:i,targetIndex:s}){this._locked||this._calcTargetPositionAndZoom(e,t,i,s),this._position.x=this._interpolation(this.x,this._targetPosition.x),this._position.y=this._interpolation(this.y,this._targetPosition.y),this._zoom=this._interpolation(this._zoom,this._targetZoom)}_calcTargetPositionAndZoom(e,t,i,s){if(this._shouldFollowMarbles)if(e.length>0){let o=e[s]?e[s]:e[0];if(this.setPosition(o.position),i){let e=Math.abs(t.zoomY-this._position.y);this.zoom=Math.max(1,(1-e/5)*4)}else this.zoom=1}else this.zoom=1}_interpolation(e,t){let i=t-e;return .03333333333333333>Math.abs(i)?t:e+i/10}renderScene(e,t){let i=60*this._zoom;e.save(),e.translate(-this.x*this._zoom,-this.y*this._zoom),e.scale(this.zoom,this.zoom),e.translate(e.canvas.width/i,e.canvas.height/i),t(e),e.restore()}constructor(){this._position={x:0,y:0},this._targetPosition={x:0,y:0},this._zoom=1,this._targetZoom=1,this._locked=!1,this._shouldFollowMarbles=!1}}var B={};B=import.meta.resolve("cdgIR");var A={};A=import.meta.resolve("lfSvD");var L={};L=import.meta.resolve("9DwmV");var U={};U=import.meta.resolve("fkRhi");var O={};O=import.meta.resolve("juMvj");class F{constructor(){this.sizeFactor=1,this._images={}}get width(){return this._canvas.width}get height(){return this._canvas.height}get canvas(){return this._canvas}async init(){await this._load(),this._canvas=document.createElement("canvas"),this._canvas.width=1600,this._canvas.height=900,this.ctx=this._canvas.getContext("2d",{alpha:!1}),document.body.appendChild(this._canvas);let e=e=>{let t=e?e[0].contentRect:this._canvas.getBoundingClientRect(),i=Math.max(t.width/2,640),s=i/t.width*t.height;this._canvas.width=i,this._canvas.height=s,this.sizeFactor=i/t.width};new ResizeObserver(e).observe(this._canvas),e()}async _loadImage(e){return new Promise(t=>{let i=new Image;i.addEventListener("load",()=>{t(i)}),i.src=e})}async _load(){let e=[{name:"챔루",imgUrl:new URL(B)},{name:"쿠빈",imgUrl:new URL(A)},{name:"꽉변",imgUrl:new URL(L)},{name:"꽉변호사",imgUrl:new URL(L)},{name:"꽉 변호사",imgUrl:new URL(L)},{name:"주누피",imgUrl:new URL(U)}].map(({name:e,imgUrl:t})=>(async()=>{this._images[e]=await this._loadImage(t.toString())})());e.push((async()=>{await this._loadImage(new URL(O).toString())})()),await Promise.all(e)}render(e,t){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this._canvas.width,this._canvas.height),this.ctx.save(),this.ctx.scale(30,30),this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.font="0.4pt sans-serif",this.ctx.lineWidth=3/(e.camera.zoom+30),e.camera.renderScene(this.ctx,()=>{this.renderEntities(e.entities),this.renderEffects(e),this.renderMarbles(e)}),this.ctx.restore(),t.forEach(t=>t.render(this.ctx,e,this._canvas.width,this._canvas.height)),e.particleManager.render(this.ctx),this.renderWinner(e)}renderEntities(e){this.ctx.save(),e.forEach(e=>{let t=this.ctx.getTransform();this.ctx.translate(e.x,e.y),this.ctx.rotate(e.angle),this.ctx.fillStyle=e.shape.color??v[e.shape.type],this.ctx.strokeStyle=e.shape.color??v[e.shape.type],this.ctx.shadowBlur=15,this.ctx.shadowColor=e.shape.bloomColor??e.shape.color??C[e.shape.type];let i=e.shape;switch(i.type){case"polyline":if(i.points.length>0){this.ctx.beginPath(),this.ctx.moveTo(i.points[0][0],i.points[0][1]);for(let e=1;e<i.points.length;e++)this.ctx.lineTo(i.points[e][0],i.points[e][1]);this.ctx.stroke()}break;case"box":let s=2*i.width,o=2*i.height;this.ctx.rotate(i.rotation),this.ctx.fillRect(-s/2,-o/2,s,o),this.ctx.strokeRect(-s/2,-o/2,s,o);break;case"circle":this.ctx.beginPath(),this.ctx.arc(0,0,i.radius,0,2*Math.PI,!1),this.ctx.stroke()}this.ctx.setTransform(t)}),this.ctx.restore()}renderEffects({effects:e,camera:t}){e.forEach(e=>e.render(this.ctx,30*t.zoom))}renderMarbles({marbles:e,camera:t,winnerRank:i,winners:s,size:o}){let r=i-s.length,n={x:t.x,y:t.y,w:o.x,h:o.y,zoom:30*t.zoom};e.forEach((e,i)=>{e.render(this.ctx,30*t.zoom,i===r,!1,this._images[e.name]||void 0,n)})}renderWinner({winner:e}){e&&(this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(this._canvas.width/2,this._canvas.height-168,this._canvas.width/2,168),this.ctx.fillStyle="white",this.ctx.font="bold 48px sans-serif",this.ctx.textAlign="right",this.ctx.fillText("Winner",this._canvas.width-10,this._canvas.height-120),this.ctx.font="bold 72px sans-serif",this.ctx.fillStyle=e.color,this.ctx.fillText(e.name,this._canvas.width-10,this._canvas.height-55),this.ctx.restore())}}class j{constructor(e,t){this._size=0,this._elapsed=0,this.isDestroy=!1,this.position={x:e,y:t}}update(e){this._elapsed+=e,this._size=this._elapsed/500*10,this._elapsed>500&&(this.isDestroy=!0)}render(e,t){e.save();let i=this._elapsed/500;e.globalAlpha=1-i*i,e.strokeStyle="white",e.lineWidth=1/t,e.beginPath(),e.arc(this.position.x,this.position.y,this._size,0,2*Math.PI),e.stroke(),e.restore()}}function z(e,t,i){return{configurable:!0,get(){let e=i.value.bind(this);return Object.defineProperty(this,t,{value:e,configurable:!0,writable:!0}),e}}}class N{constructor(){this._currentY=0,this._targetY=0,this.fontHeight=16,this._userMoved=0,this._currentWinner=-1,this.maxY=0,this.winners=[],this.marbles=[],this.winnerRank=-1}onWheel(e){this._targetY+=e.deltaY,this._targetY>this.maxY&&(this._targetY=this.maxY),this._userMoved=2e3}onDblClick(e){if(e&&navigator.clipboard){let e=[],t=0;e.push(...[...this.winners,...this.marbles].map(e=>(t++,[t.toString(),e.name,t-1===this.winnerRank?"☆":""].join("	")))),e.unshift("Rank	Name	Winner"),navigator.clipboard.writeText(e.join("\n")).then(()=>{this.messageHandler&&this.messageHandler("The result has been copied")})}}onMessage(e){this.messageHandler=e}render(e,{winners:t,marbles:i,winnerRank:s},o,r){let n=o-5,a=Math.max(-this.fontHeight,this._currentY-r/2);this.maxY=Math.max(0,(i.length+t.length)*this.fontHeight+this.fontHeight),this._currentWinner=t.length,this.winners=t,this.marbles=i,this.winnerRank=s,e.save(),e.textAlign="right",e.font="10pt sans-serif",e.fillStyle="#666",e.fillText(`${t.length} / ${t.length+i.length}`,o-5,this.fontHeight),e.beginPath(),e.rect(0,this.fontHeight+2,o,this.maxY),e.clip(),e.translate(0,-a),e.font="bold 11pt sans-serif",t.forEach((t,i)=>{let o=i*this.fontHeight;o>=a&&o<=a+e.canvas.height&&(e.fillStyle=t.color,e.fillText(`${i===s?"☆":"✔"} ${t.name} #${i+1}`,n,20+o))}),e.font="10pt sans-serif",i.forEach((i,s)=>{let o=(s+t.length)*this.fontHeight;o>=a&&o<=a+e.canvas.height&&(e.fillStyle=i.color,e.fillText(`${i.name} #${s+1+t.length}`,n,20+o))}),e.restore()}update(e){-1!==this._currentWinner&&(this._userMoved>0?this._userMoved-=e:this._targetY=this._currentWinner*this.fontHeight+this.fontHeight,this._currentY!==this._targetY&&(this._currentY+=(this._targetY-this._currentY)*(e/250)),1>Math.abs(this._currentY-this._targetY)&&(this._currentY=this._targetY))}getBoundingBox(){return null}}_([z],N.prototype,"onWheel",null),_([z],N.prototype,"onDblClick",null);class G{constructor(){this.lastParams=null,this._onViewportChangeHandler=null,this.mousePosition=null,this.boundingBox={x:10,y:10,w:104,h:0}}getBoundingBox(){return this.boundingBox}onViewportChange(e){this._onViewportChangeHandler=e}update(){}onMouseMove(e){if(!e){this.mousePosition=null,this._onViewportChangeHandler&&this._onViewportChangeHandler();return}this.lastParams&&(this.mousePosition={x:e.x,y:e.y},this._onViewportChangeHandler&&this._onViewportChangeHandler({x:this.mousePosition.x/4,y:this.mousePosition.y/4}))}render(e,t){if(!e)return;let{stage:i}=t;i&&(this.boundingBox.h=4*i.goalY,this.lastParams=t,this.ctx=e,e.save(),e.fillStyle="#333",e.translate(10,10),e.scale(4,4),e.fillRect(0,0,26,i.goalY),this.ctx.lineWidth=3/(t.camera.zoom+30),this.drawEntities(t.entities),this.drawMarbles(t),this.drawViewport(t),e.restore(),e.save(),e.strokeStyle="green",e.lineWidth=1,e.strokeRect(this.boundingBox.x,this.boundingBox.y,this.boundingBox.w,this.boundingBox.h),e.restore())}drawViewport(e){this.ctx.save();let{camera:t,size:i}=e,s=30*t.zoom,o=i.x/s,r=i.y/s;this.ctx.strokeStyle="white",this.ctx.lineWidth=1/s,this.ctx.strokeRect(t.x-o/2,t.y-r/2,o,r),this.ctx.restore()}drawEntities(e){this.ctx.save(),e.forEach(e=>{this.ctx.save(),this.ctx.fillStyle=e.shape.color??v[e.shape.type],this.ctx.strokeStyle=e.shape.color??v[e.shape.type],this.ctx.translate(e.x,e.y),this.ctx.rotate(e.angle),this.ctx.save();let t=e.shape;switch(t.type){case"box":let i=2*t.width,s=2*t.height;this.ctx.rotate(t.rotation),this.ctx.fillRect(-i/2,-s/2,i,s);break;case"circle":this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,2*Math.PI,!1),this.ctx.stroke();break;case"polyline":if(t.points.length>0){this.ctx.beginPath(),this.ctx.moveTo(t.points[0][0],t.points[0][1]);for(let e=1;e<t.points.length;e++)this.ctx.lineTo(t.points[e][0],t.points[e][1]);this.ctx.stroke()}}this.ctx.restore(),this.ctx.restore()}),this.ctx.restore()}drawMarbles(e){let{marbles:t}=e,i={x:e.camera.x,y:e.camera.y,w:e.size.x,h:e.size.y,zoom:30*e.camera.zoom};t.forEach(e=>{e.render(this.ctx,1,!1,!0,void 0,i)})}}_([z],G.prototype,"onMouseMove",null);class H{constructor(e){this.chunks=[],this.stopping=!1,this.targetCanvas=e,this.videoStream=this.targetCanvas.captureStream(),this.mediaRecorder=new MediaRecorder(this.videoStream,{videoBitsPerSecond:6e6})}async start(){return this.stopping=!1,new Promise(e=>{this.chunks=[],this.mediaRecorder.ondataavailable=e=>{this.chunks.push(e.data)},this.mediaRecorder.onstop=()=>{let e=new Blob(this.chunks,{type:"video/mp4"}),t=URL.createObjectURL(e),i=document.createElement("a"),s=new Date;i.href=t,i.download=`marble_roulette_${s.getFullYear()}${E(s.getMonth()+1)}${E(s.getDate())}${E(s.getHours())}${E(s.getMinutes())}${E(s.getSeconds())}.mp4`,i.click(),i.remove(),URL.revokeObjectURL(t)},this.mediaRecorder.onstart=()=>{e()},this.mediaRecorder.start()})}stop(){this.stopping=!0,"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop()}}var $=async(...e)=>{let t=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),{default:i}=await (t?g("iyjrR"):g("8ZFBQ"));return await i(...e)};class Y{async init(){this.Box2D=await $(),this.gravity=new this.Box2D.b2Vec2(0,10),this.world=new this.Box2D.b2World(this.gravity),console.log("box2d ready")}clear(){this.clearEntities()}clearMarbles(){Object.values(this.marbleMap).forEach(e=>{this.world.DestroyBody(e)}),this.marbleMap={}}createStage(e){this.createEntities(e.entities)}createEntities(e){if(!e)return;let t={static:this.Box2D.b2_staticBody,kinematic:this.Box2D.b2_kinematicBody};e.forEach(e=>{let i,s=new this.Box2D.b2BodyDef;s.set_type(t[e.type]);let o=this.world.CreateBody(s),r=new this.Box2D.b2FixtureDef;switch(r.set_density(e.props.density),r.set_restitution(e.props.restitution),e.shape.type){case"box":(i=new this.Box2D.b2PolygonShape).SetAsBox(e.shape.width,e.shape.height,0,e.shape.rotation),r.set_shape(i),o.CreateFixture(r);break;case"polyline":i=new this.Box2D.b2EdgeShape;for(let t=0;t<e.shape.points.length-1;t++){let i=e.shape.points[t],s=e.shape.points[t+1],r=new this.Box2D.b2Vec2(i[0],i[1]),n=new this.Box2D.b2Vec2(s[0],s[1]),a=new this.Box2D.b2EdgeShape;a.SetTwoSided(r,n),o.CreateFixture(a,1)}break;case"circle":(i=new this.Box2D.b2CircleShape).set_m_radius(e.shape.radius),r.set_shape(i),o.CreateFixture(r)}o.SetAngularVelocity(e.props.angularVelocity),o.SetTransform(new this.Box2D.b2Vec2(e.position.x,e.position.y),0),this.entities.push({body:o,x:e.position.x,y:e.position.y,angle:0,shape:e.shape,life:e.props.life??-1})})}clearEntities(){this.entities.forEach(e=>{this.world.DestroyBody(e.body)}),this.entities=[]}createMarble(e,t,i){let s=new this.Box2D.b2CircleShape;s.set_m_radius(.25);let o=new this.Box2D.b2BodyDef;o.set_type(this.Box2D.b2_dynamicBody),o.set_position(new this.Box2D.b2Vec2(t,i));let r=this.world.CreateBody(o);r.CreateFixture(s,1+Math.random()),r.SetAwake(!1),r.SetEnabled(!1),this.marbleMap[e]=r}shakeMarble(e){let t=this.marbleMap[e];t&&t.ApplyLinearImpulseToCenter(new this.Box2D.b2Vec2(10*Math.random()-5,10*Math.random()-5),!0)}removeMarble(e){let t=this.marbleMap[e];t&&(this.world.DestroyBody(t),delete this.marbleMap[e])}getMarblePosition(e){let t=this.marbleMap[e];if(!t)return{x:0,y:0,angle:0};{let e=t.GetPosition();return{x:e.x,y:e.y,angle:t.GetAngle()}}}getEntities(){return this.entities.map(e=>({...e,angle:e.body.GetAngle()}))}impact(e){let t=this.marbleMap[e];t&&Object.values(this.marbleMap).forEach(e=>{if(e===t)return;let i=new this.Box2D.b2Vec2(e.GetPosition().x,e.GetPosition().y);if(i.op_sub(t.GetPosition()),100>i.LengthSquared()){i.Normalize();let t=1-i.Length()/10;i.op_mul(t*t*5),e.ApplyLinearImpulseToCenter(i,!0)}})}start(){for(let e in this.marbleMap){let t=this.marbleMap[e];t.SetAwake(!0),t.SetEnabled(!0)}}step(e){this.deleteCandidates.forEach(e=>{this.world.DestroyBody(e)}),this.deleteCandidates=[],this.world.Step(e,6,2);for(let e=this.entities.length-1;e>=0;e--){let t=this.entities[e];if(t.life>0){let i=t.body.GetContactList();i.contact&&i.contact.IsTouching()&&(this.deleteCandidates.push(t.body),this.entities.splice(e,1))}}}constructor(){this.marbleMap={},this.entities=[],this.deleteCandidates=[]}}class W{constructor(){this.bound={x:0,y:0,w:0,h:0},this.isEnabled=!1,this.icon=new Image,this.icon.src=new URL(O).toString()}get speed(){return this.isEnabled?2:1}setEnabled(e){this.isEnabled=e}getEnabled(){return this.isEnabled}update(e){}render(e,t,i,s){this.bound.w=i/2,this.bound.h=s/2,this.bound.x=this.bound.w/2,this.bound.y=this.bound.h/2;let o=this.bound.x+this.bound.w/2,r=this.bound.y+this.bound.h/2;this.isEnabled&&(e.save(),e.strokeStyle="white",e.globalAlpha=.5,e.drawImage(this.icon,o-25,r-25,25,25),e.restore())}getBoundingBox(){return this.bound}onMouseDown(e){this.isEnabled=!0}onMouseUp(e){this.isEnabled=!1}}class J extends EventTarget{get isReady(){return this._isReady}constructor(){super(),this._marbles=[],this._lastTime=0,this._elapsed=0,this._noMoveDuration=0,this._shakeAvailable=!1,this._updateInterval=10,this._timeScale=1,this._speed=1,this._winners=[],this._particleManager=new I,this._stage=null,this._camera=new D,this._renderer=new F,this._effects=[],this._winnerRank=0,this._totalMarbleCount=0,this._goalDist=1/0,this._isRunning=!1,this._winner=null,this._uiObjects=[],this._autoRecording=!1,this._isReady=!1,this._randomSeed=null,this._renderer.init().then(()=>{this._init().then(()=>{this._isReady=!0,this._update()})})}getZoom(){return 30*this._camera.zoom}getFastForwarder(){return this.fastForwarder}addUiObject(e){this._uiObjects.push(e),e.onWheel&&this._renderer.canvas.addEventListener("wheel",e.onWheel),e.onMessage&&e.onMessage(e=>{console.log("onMessage",e),this.dispatchEvent(new CustomEvent("message",{detail:e}))})}_update(){this._lastTime||(this._lastTime=Date.now());let e=Date.now();this._elapsed+=(e-this._lastTime)*this._speed*this.fastForwarder.speed,this._elapsed>100&&(this._elapsed%=100),this._lastTime=e;let t=this._updateInterval/1e3*this._timeScale;for(;this._elapsed>=this._updateInterval;)this.physics.step(t),this._updateMarbles(this._updateInterval),this._particleManager.update(this._updateInterval),this._updateEffects(this._updateInterval),this._elapsed-=this._updateInterval,this._uiObjects.forEach(e=>e.update(this._updateInterval));this._marbles.length>1&&this._marbles.sort((e,t)=>t.y-e.y),this._stage&&(this._camera.update({marbles:this._marbles,stage:this._stage,needToZoom:this._goalDist<5,targetIndex:this._winners.length>0?this._winnerRank-this._winners.length:0}),this._isRunning&&this._marbles.length>0&&this._noMoveDuration>3e3?this._changeShakeAvailable(!0):this._changeShakeAvailable(!1)),this._render(),window.requestAnimationFrame(this._update)}_updateMarbles(e){if(!this._stage)return;for(let t=0;t<this._marbles.length;t++){let i=this._marbles[t];i.update(e),i.skill===w.Impact&&(this._effects.push(new j(i.x,i.y)),this.physics.impact(i.id)),i.y>this._stage.goalY&&(this._winners.push(i),this._isRunning&&this._winners.length===this._winnerRank+1?(this.dispatchEvent(new CustomEvent("goal",{detail:{winner:i.name}})),this._winner=i,this._isRunning=!1,this._particleManager.shot(this._renderer.width,this._renderer.height),setTimeout(()=>{this._recorder.stop()},1e3)):this._isRunning&&this._winnerRank===this._winners.length&&this._winnerRank===this._totalMarbleCount-1&&(this.dispatchEvent(new CustomEvent("goal",{detail:{winner:this._marbles[t+1].name}})),this._winner=this._marbles[t+1],this._isRunning=!1,this._particleManager.shot(this._renderer.width,this._renderer.height),setTimeout(()=>{this._recorder.stop()},1e3)),setTimeout(()=>{this.physics.removeMarble(i.id)},500))}let t=this._winnerRank-this._winners.length,i=this._marbles[t]?this._marbles[t].y:0;this._goalDist=Math.abs(this._stage.zoomY-i),this._timeScale=this._calcTimeScale(),this._marbles=this._marbles.filter(e=>e.y<=this._stage.goalY)}_calcTimeScale(){if(!this._stage)return 1;let e=this._winnerRank-this._winners.length;return this._winners.length<this._winnerRank+1&&this._goalDist<5&&this._marbles[e].y>this._stage.zoomY-6&&(this._marbles[e-1]||this._marbles[e+1])?Math.max(.2,this._goalDist/5):1}_updateEffects(e){this._effects.forEach(t=>t.update(e)),this._effects=this._effects.filter(e=>!e.isDestroy)}_render(){if(!this._stage)return;let e={camera:this._camera,stage:this._stage,entities:this.physics.getEntities(),marbles:this._marbles,winners:this._winners,particleManager:this._particleManager,effects:this._effects,winnerRank:this._winnerRank,winner:this._winner,size:{x:this._renderer.width,y:this._renderer.height}};this._renderer.render(e,this._uiObjects)}async _init(){this._recorder=new H(this._renderer.canvas),this.physics=new Y,await this.physics.init(),this.addUiObject(new N),this.attachEvent();let e=new G;e.onViewportChange(e=>{e?(this._camera.setPosition(e,!1),this._camera.lock(!0)):this._camera.lock(!1)}),this.addUiObject(e),this.fastForwarder=new W,this.addUiObject(this.fastForwarder),this._stage=V[0],this._loadMap()}mouseHandler(e,t){let i=`on${e}`,s=this._renderer.sizeFactor,o={x:t.offsetX*s,y:t.offsetY*s};this._uiObjects.forEach(e=>{if(!e[i])return;let s=e.getBoundingBox();s?s&&o.x>=s.x&&o.y>=s.y&&o.x<=s.x+s.w&&o.y<=s.y+s.h?e[i]({x:o.x-s.x,y:o.y-s.y,button:t.button}):e[i](void 0):e[i]({...o,button:t.button})})}attachEvent(){["MouseMove","MouseUp","MouseDown","DblClick"].forEach(e=>{this._renderer.canvas.addEventListener(e.toLowerCase().replace("mouse","pointer"),this.mouseHandler.bind(this,e))}),this._renderer.canvas.addEventListener("contextmenu",e=>{e.preventDefault()})}_loadMap(){if(!this._stage)throw Error("No map has been selected");this.physics.createStage(this._stage),this._camera.initializePosition()}clearMarbles(){this.physics.clearMarbles(),this._winner=null,this._winners=[],this._marbles=[]}start(){this._isRunning=!0,this._winnerRank=R.winningRank,this._winnerRank>=this._marbles.length&&(this._winnerRank=this._marbles.length-1),this._camera.startFollowingMarbles(),this._autoRecording?this._recorder.start().then(()=>{this.physics.start(),this._marbles.forEach(e=>e.isActive=!0)}):(this.physics.start(),this._marbles.forEach(e=>e.isActive=!0))}setSpeed(e){if(e<=0)throw Error("Speed multiplier must larger than 0");this._speed=e}getSpeed(){return this._speed}setWinningRank(e){this._winnerRank=e}setAutoRecording(e){this._autoRecording=e}setRandomSeed(e){this._randomSeed=e}createSeededRandom(e){return function(){let t=e+=0x6d2b79f5;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/0x100000000}}setMarbles(e){this.reset();let t=e.slice(),i=-1/0,s=1/0,o=t.map(e=>{let t=function(e){let t=/\/(\d+)/,i=/\*(\d+)/,s=t.test(e),o=i.test(e),r=k(/^\s*([^\/*]+)?/,e);return r?{name:r,weight:s?parseInt(k(t,e)):1,count:o?parseInt(k(i,e)):1}:null}(e);if(!t)return null;let{name:o,weight:r,count:n}=t;return r>i&&(i=r),r<s&&(s=r),{name:o,weight:r,count:n}}).filter(e=>!!e),r=i-s,n=0;o.forEach(e=>{e&&(e.weight=.1+(r?(e.weight-s)/r:0),n+=e.count)});let a=null!==this._randomSeed?this.createSeededRandom(this._randomSeed):Math.random,c=Array(n).fill(0).map((e,t)=>t).sort(()=>a()-.5);o.forEach(e=>{if(e)for(let t=0;t<e.count;t++){let t=c.pop()||0;this._marbles.push(new P(this.physics,t,n,e.name,e.weight))}}),this._totalMarbleCount=n}_clearMap(){this.physics.clear(),this._marbles=[]}reset(){this.clearMarbles(),this._clearMap(),this._loadMap(),this._goalDist=1/0}getCount(){return this._marbles.length}_changeShakeAvailable(e){this._shakeAvailable!==e&&(this._shakeAvailable=e,this.dispatchEvent(new CustomEvent("shakeAvailableChanged",{detail:e})))}shake(){if(!this._shakeAvailable)return}getMaps(){return V.map((e,t)=>({index:t,title:e.title}))}setMap(e){if(e<0||e>V.length-1)throw Error("Incorrect map number");let t=this._marbles.map(e=>e.name);this._stage=V[e],this.setMarbles(t),this._camera.initializePosition()}}_([z],J.prototype,"_update",null),_([z],J.prototype,"mouseHandler",null);class K{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){let e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){let e=[];for(let t of this._parts)e.push(t);return function(e){let t=0;for(let i of e)t+=i.byteLength;let i=new Uint8Array(t),s=0;for(let t of e){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);i.set(e,s),s+=t.byteLength}return i}(e).buffer}}function q(e){return new Q(e).unpack()}function Z(e){let t=new X,i=t.pack(e);return i instanceof Promise?i.then(()=>t.getBuffer()):t.getBuffer()}class Q{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){let e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}}unpack_uint8(){let e=255&this.dataView[this.index];return this.index++,e}unpack_uint16(){let e=this.read(2),t=(255&e[0])*256+(255&e[1]);return this.index+=2,t}unpack_uint32(){let e=this.read(4),t=((256*e[0]+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){let e=this.read(8),t=((((((256*e[0]+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){let e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){let e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){let e=this.unpack_uint32();return e<0x80000000?e:e-0x100000000}unpack_int64(){let e=this.unpack_uint64();return e<0x8000000000000000?e:e-0xffffffffffffffff}unpack_raw(e){if(this.length<this.index+e)throw Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);let t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){let t,i,s=this.read(e),o=0,r="";for(;o<e;)(t=s[o])<160?(i=t,o++):(192^t)<32?(i=(31&t)<<6|63&s[o+1],o+=2):(224^t)<16?(i=(15&t)<<12|(63&s[o+1])<<6|63&s[o+2],o+=3):(i=(7&t)<<18|(63&s[o+1])<<12|(63&s[o+2])<<6|63&s[o+3],o+=4),r+=String.fromCodePoint(i);return this.index+=e,r}unpack_array(e){let t=Array(e);for(let i=0;i<e;i++)t[i]=this.unpack();return t}unpack_map(e){let t={};for(let i=0;i<e;i++)t[this.unpack()]=this.unpack();return t}unpack_float(){let e=this.unpack_uint32();return(0==e>>31?1:-1)*(8388607&e|8388608)*2**((e>>23&255)-127-23)}unpack_double(){let e=this.unpack_uint32(),t=this.unpack_uint32(),i=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*2**(i-20)+t*2**(i-52))}read(e){let t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw Error("BinaryPackFailure: read index out of range")}}class X{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if("string"==typeof e)this.pack_string(e);else if("number"==typeof e)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==typeof e)!0===e?this._bufferBuilder.append(195):!1===e&&this._bufferBuilder.append(194);else if(void 0===e)this._bufferBuilder.append(192);else if("object"==typeof e)if(null===e)this._bufferBuilder.append(192);else{let t=e.constructor;if(e instanceof Array){let t=this.pack_array(e);if(t instanceof Promise)return t.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e)this.pack_bin(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));else if(e instanceof Date)this.pack_string(e.toString());else if(e instanceof Blob)return e.arrayBuffer().then(e=>{this.pack_bin(new Uint8Array(e)),this._bufferBuilder.flush()});else if(t==Object||t.toString().startsWith("class")){let t=this.pack_object(e);if(t instanceof Promise)return t.then(()=>this._bufferBuilder.flush())}else throw Error(`Type "${t.toString()}" not yet supported`)}else throw Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){let t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=0xffffffff)this._bufferBuilder.append(219),this.pack_uint32(t);else throw Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){let t=this._textEncoder.encode(e),i=t.length;if(i<=15)this.pack_uint8(176+i);else if(i<=65535)this._bufferBuilder.append(216),this.pack_uint16(i);else if(i<=0xffffffff)this._bufferBuilder.append(217),this.pack_uint32(i);else throw Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){let t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=0xffffffff)this._bufferBuilder.append(221),this.pack_uint32(t);else throw Error("Invalid length");let i=s=>{if(s<t){let t=this.pack(e[s]);return t instanceof Promise?t.then(()=>i(s+1)):i(s+1)}};return i(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(255&e);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=0xffffffff)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-0x80000000&&e<=0x7fffffff)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x8000000000000000)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=0xffffffffffffffff)this._bufferBuilder.append(207),this.pack_uint64(e);else throw Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);let i=Math.floor(Math.log(e)/Math.LN2),s=Math.floor((e/2**i-1)*0x10000000000000),o=t<<31|i+1023<<20|s/0x100000000&1048575;this._bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(s%0x100000000)}pack_object(e){let t=Object.keys(e),i=t.length;if(i<=15)this.pack_uint8(128+i);else if(i<=65535)this._bufferBuilder.append(222),this.pack_uint16(i);else if(i<=0xffffffff)this._bufferBuilder.append(223),this.pack_uint32(i);else throw Error("Invalid length");let s=i=>{if(i<t.length){let o=t[i];if(e.hasOwnProperty(o)){this.pack(o);let t=this.pack(e[o]);if(t instanceof Promise)return t.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(255&e)}pack_uint32(e){let t=0|e;this._bufferBuilder.append((0xff000000&t)>>>24),this._bufferBuilder.append((0xff0000&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t)}pack_uint64(e){let t=e/0x100000000,i=e%0x100000000;this._bufferBuilder.append((0xff000000&t)>>>24),this._bufferBuilder.append((0xff0000&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t),this._bufferBuilder.append((0xff000000&i)>>>24),this._bufferBuilder.append((0xff0000&i)>>>16),this._bufferBuilder.append((65280&i)>>>8),this._bufferBuilder.append(255&i)}pack_int8(e){this._bufferBuilder.append(255&e)}pack_int16(e){this._bufferBuilder.append((65280&e)>>8),this._bufferBuilder.append(255&e)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((0xff0000&e)>>>16),this._bufferBuilder.append((65280&e)>>>8),this._bufferBuilder.append(255&e)}pack_int64(e){let t=Math.floor(e/0x100000000),i=e%0x100000000;this._bufferBuilder.append((0xff000000&t)>>>24),this._bufferBuilder.append((0xff0000&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t),this._bufferBuilder.append((0xff000000&i)>>>24),this._bufferBuilder.append((0xff0000&i)>>>16),this._bufferBuilder.append((65280&i)>>>8),this._bufferBuilder.append(255&i)}constructor(){this._bufferBuilder=new K,this._textEncoder=new TextEncoder}}let ee=!0,et=!0;function ei(e,t,i){let s=e.match(t);return s&&s.length>=i&&parseFloat(s[i],10)}function es(e,t,i){if(!e.RTCPeerConnection)return;let s=e.RTCPeerConnection.prototype,o=s.addEventListener;s.addEventListener=function(e,s){if(e!==t)return o.apply(this,arguments);let r=e=>{let t=i(e);t&&(s.handleEvent?s.handleEvent(t):s(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(s,r),o.apply(this,[e,r])};let r=s.removeEventListener;s.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(i))return r.apply(this,arguments);let s=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,r.apply(this,[e,s])},Object.defineProperty(s,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function eo(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(ee=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function er(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(et=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function en(){"object"==typeof window&&(ee||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))}function ea(e,t){et&&console.warn(e+" is deprecated, please use "+t+" instead.")}function ec(e){return"[object Object]"===Object.prototype.toString.call(e)}function ep(e,t,i){let s=i?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;let r=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&r.push(e)}),r.forEach(t=>{e.forEach(i=>{i.type===s&&i.trackId===t.id&&function e(t,i,s){!i||s.has(i.id)||(s.set(i.id,i),Object.keys(i).forEach(o=>{o.endsWith("Id")?e(t,t.get(i[o]),s):o.endsWith("Ids")&&i[o].forEach(i=>{e(t,t.get(i),s)})}))}(e,i,o)})}),o}var el={};function eh(e,t){let i=e&&e.navigator;if(!i.mediaDevices)return;let s=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach(i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;let s="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==s.exact&&"number"==typeof s.exact&&(s.min=s.max=s.exact);let o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==s.ideal){t.optional=t.optional||[];let e={};"number"==typeof s.ideal?(e[o("min",i)]=s.ideal,t.optional.push(e),(e={})[o("max",i)]=s.ideal):e[o("",i)]=s.ideal,t.optional.push(e)}void 0!==s.exact&&"number"!=typeof s.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",i)]=s.exact):["min","max"].forEach(e=>{void 0!==s[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,i)]=s[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"==typeof e.video){let r=e.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});let n=t.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&!(i.mediaDevices.getSupportedConstraints&&i.mediaDevices.getSupportedConstraints().facingMode&&!n)){let t;if(delete e.video.facingMode,"environment"===r.exact||"environment"===r.ideal?t=["back","rear"]:("user"===r.exact||"user"===r.ideal)&&(t=["front"]),t)return i.mediaDevices.enumerateDevices().then(i=>{let n=(i=i.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!n&&i.length&&t.includes("back")&&(n=i[i.length-1]),n&&(e.video.deviceId=r.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=s(e.video),en("chrome: "+JSON.stringify(e)),o(e)})}e.video=s(e.video)}return en("chrome: "+JSON.stringify(e)),o(e)},r=function(e){return t.version>=64?e:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(e,t,s){o(e,e=>{i.webkitGetUserMedia(e,t,e=>{s&&s(r(e))})})}).bind(i),i.mediaDevices.getUserMedia){let e=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return o(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(r(e))))}}}function ed(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function ey(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)es(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.track.id):{track:i.track};let o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[t.stream],this.dispatchEvent(o)}),t.stream.getTracks().forEach(i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.id):{track:i};let o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[t.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function eu(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,s){let o=i.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){s.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};let s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach(e=>{let t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ef(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>ep(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),es(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>ep(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,i,s=arguments[0];return(this.getSenders().forEach(t=>{t.track===s&&(e?i=!0:e=t)}),this.getReceivers().forEach(e=>(e.track===s&&(t?i=!0:t=e),e.track===s)),i||e&&t)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function eg(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let s=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(s)&&this._shimmedLocalStreams[i.id].push(s):this._shimmedLocalStreams[i.id]=[i,s],s};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let t=this.getSenders();i.apply(this,arguments);let s=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(s)};let s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],s.apply(this,arguments)};let o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{let i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),o.apply(this,arguments)}}function em(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return eg(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};let s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){let i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}s.apply(this,[t])};let o=e.RTCPeerConnection.prototype.removeStream;function r(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let s=e._reverseStreams[t],o=e._streams[s.id];i=i.replace(RegExp(o.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let s=[].slice.call(arguments,1);if(1!==s.length||!s[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let o=this._streams[i.id];if(o)o.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let s=new e.MediaStream([t]);this._streams[i.id]=s,this._reverseStreams[s.id]=i,this.addStream(s)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){let i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){let e=arguments,t=arguments.length&&"function"==typeof arguments[0];return t?i.apply(this,[t=>{let i=r(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then(e=>r(this,e))}})[t]});let n=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t;let i;return arguments.length&&arguments[0].type?(arguments[0]=(e=this,t=arguments[0],i=t.sdp,Object.keys(e._reverseStreams||[]).forEach(t=>{let s=e._reverseStreams[t],o=e._streams[s.id];i=i.replace(RegExp(s.id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:i})),n.apply(this,arguments)):n.apply(this,arguments)};let a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=a.get.apply(this);return""===e.type?e:r(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){let t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(i=>{this._streams[i].getTracks().find(t=>e.track===t)&&(t=this._streams[i])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function eb(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}})[t]})}function ex(e,t){es(e,"negotiationneeded",e=>{let i=e.target;if(!(t.version<72)&&(!i.getConfiguration||"plan-b"!==i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e})}t(el,"shimMediaStream",()=>ed),t(el,"shimOnTrack",()=>ey),t(el,"shimGetSendersWithDtmf",()=>eu),t(el,"shimSenderReceiverGetStats",()=>ef),t(el,"shimAddTrackRemoveTrackWithNative",()=>eg),t(el,"shimAddTrackRemoveTrack",()=>em),t(el,"shimPeerConnection",()=>eb),t(el,"fixNegotiationNeeded",()=>ex),t(el,"shimGetUserMedia",()=>eh);var e_={};function ew(e,t){let i=e&&e.navigator,s=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,s){ea("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,s)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"==typeof i&&"object"==typeof i.audio&&(e((i=JSON.parse(JSON.stringify(i))).audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},s&&s.prototype.getSettings){let t=s.prototype.getSettings;s.prototype.getSettings=function(){let i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(s&&s.prototype.applyConstraints){let t=s.prototype.applyConstraints;s.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"==typeof i&&(e(i=JSON.parse(JSON.stringify(i)),"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function ev(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function eC(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function eS(e,t){if("object"!=typeof e||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let i=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}})[t]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,o,r]=arguments;return s.apply(this,[e||null]).then(e=>{if(t.version<53&&!o)try{e.forEach(e=>{e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,s)=>{e.set(s,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(o,r)}}function ek(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function eE(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),es(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function eR(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){ea("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function eT(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function eP(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);let i=(e=[...e]).length>0;i&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let s=t.apply(this,arguments);if(i){let{sender:t}=s,i=t.getParameters();"encodings"in i&&(1!==i.encodings.length||0!==Object.keys(i.encodings[0]).length)||(i.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(i).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return s})}function eM(e){if(!("object"==typeof e&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function eI(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function eV(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}t(e_,"shimOnTrack",()=>eC),t(e_,"shimPeerConnection",()=>eS),t(e_,"shimSenderGetStats",()=>ek),t(e_,"shimReceiverGetStats",()=>eE),t(e_,"shimRemoveStream",()=>eR),t(e_,"shimRTCDataChannel",()=>eT),t(e_,"shimAddTransceiver",()=>eP),t(e_,"shimGetParameters",()=>eM),t(e_,"shimCreateOffer",()=>eI),t(e_,"shimCreateAnswer",()=>eV),t(e_,"shimGetUserMedia",()=>ew),t(e_,"shimGetDisplayMedia",()=>ev);var eD={};function eB(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>t.call(this,i,e)),e.getVideoTracks().forEach(i=>t.call(this,i,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let i=e.getTracks();this.getSenders().forEach(e=>{i.includes(e.track)&&this.removeTrack(e)})})}}function eA(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);let t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let i=new Event("addstream");i.stream=t,e.dispatchEvent(i)})}),t.apply(e,arguments)}}}function eL(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,i=t.createOffer,s=t.createAnswer,o=t.setLocalDescription,r=t.setRemoteDescription,n=t.addIceCandidate;t.createOffer=function(e,t){let s=arguments.length>=2?arguments[2]:arguments[0],o=i.apply(this,[s]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){let i=arguments.length>=2?arguments[2]:arguments[0],o=s.apply(this,[i]);return t?(o.then(e,t),Promise.resolve()):o};let a=function(e,t,i){let s=o.apply(this,[e]);return i?(s.then(t,i),Promise.resolve()):s};t.setLocalDescription=a,t.setRemoteDescription=a=function(e,t,i){let s=r.apply(this,[e]);return i?(s.then(t,i),Promise.resolve()):s},t.addIceCandidate=function(e,t,i){let s=n.apply(this,[e]);return i?(s.then(t,i),Promise.resolve()):s}}function eU(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(eO(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,i,s){t.mediaDevices.getUserMedia(e).then(i,s)}).bind(t))}function eO(e){return e&&void 0!==e.video?Object.assign({},e,{video:function e(t){return ec(t)?Object.keys(t).reduce(function(i,s){let o=ec(t[s]),r=o?e(t[s]):t[s],n=o&&!Object.keys(r).length;return void 0===r||n?i:Object.assign(i,{[s]:r})},{}):t}(e.video)}):e}function eF(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){let t=[];for(let i=0;i<e.iceServers.length;i++){let s=e.iceServers[i];void 0===s.urls&&s.url?(ea("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,t.push(s)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ej(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ez(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let i=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function eN(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}t(eD,"shimLocalStreamsAPI",()=>eB),t(eD,"shimRemoteStreamsAPI",()=>eA),t(eD,"shimCallbacksAPI",()=>eL),t(eD,"shimGetUserMedia",()=>eU),t(eD,"shimConstraints",()=>eO),t(eD,"shimRTCIceServerUrls",()=>eF),t(eD,"shimTrackEventTransceiver",()=>ej),t(eD,"shimCreateOfferLegacy",()=>ez),t(eD,"shimAudioContext",()=>eN);var eG={};t(eG,"shimRTCIceCandidate",()=>eY),t(eG,"shimRTCIceCandidateRelayProtocol",()=>eW),t(eG,"shimMaxMessageSize",()=>eJ),t(eG,"shimSendThrowTypeError",()=>eK),t(eG,"shimConnectionState",()=>eq),t(eG,"removeExtmapAllowMixed",()=>eZ),t(eG,"shimAddIceCandidateNullOrEmpty",()=>eQ),t(eG,"shimParameterlessSetLocalDescription",()=>eX);var eH={};const e$={};function eY(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){let s=new t(e),o=i(eH).parseCandidate(e.candidate);for(let e in o)e in s||Object.defineProperty(s,e,{value:o[e]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,es(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function eW(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||es(e,"icecandidate",e=>{if(e.candidate){let t=i(eH).parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[t.priority>>24])}return e})}function eJ(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let s=function(e){if(!e||!e.sdp)return!1;let t=i(eH).splitSections(e.sdp);return t.shift(),t.some(e=>{let t=i(eH).parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},o=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return -1;let i=parseInt(t[1],10);return i!=i?-1:i},r=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:0x7ffffff5:t.version<60?57===t.version?65535:65536:0x7ffffff5),i},n=function(e,s){let o=65536;"firefox"===t.browser&&57===t.version&&(o=65535);let r=i(eH).matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?o=parseInt(r[0].substring(19),10):"firefox"===t.browser&&-1!==s&&(o=0x7ffffff5),o},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){let e,t=o(arguments[0]),i=r(t),s=n(arguments[0],t);e=0===i&&0===s?1/0:0===i||0===s?Math.max(i,s):Math.min(i,s);let a={};Object.defineProperty(a,"maxMessageSize",{get:()=>e}),this._sctp=a}return a.apply(this,arguments)}}function eK(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let i=e.send;e.send=function(){let s=arguments[0],o=s.length||s.size||s.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=i.apply(this,arguments);return t(e,this),e},es(e,"datachannel",e=>(t(e.channel,e.target),e))}function eq(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{let i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function eZ(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t._safariVersion>=13.1)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let i=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return i.apply(this,arguments)}}function eQ(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function eX(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return i.apply(this,arguments);if(!(e={type:e.type,sdp:e.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?i.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>i.apply(this,[e]))})}e$.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e$.localCName=e$.generateIdentifier(),e$.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},e$.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},e$.getDescription=function(e){let t=e$.splitSections(e);return t&&t[0]},e$.getMediaSections=function(e){let t=e$.splitSections(e);return t.shift(),t},e$.matchPrefix=function(e,t){return e$.splitLines(e).filter(e=>0===e.indexOf(t))},e$.parseCandidate=function(e){let t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":i.relatedAddress=t[e+1];break;case"rport":i.relatedPort=parseInt(t[e+1],10);break;case"tcptype":i.tcpType=t[e+1];break;case"ufrag":i.ufrag=t[e+1],i.usernameFragment=t[e+1];break;default:void 0===i[t[e]]&&(i[t[e]]=t[e+1])}return i},e$.writeCandidate=function(e){let t=[];t.push(e.foundation);let i=e.component;"rtp"===i?t.push(1):"rtcp"===i?t.push(2):t.push(i),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let s=e.type;return t.push("typ"),t.push(s),"host"!==s&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},e$.parseIceOptions=function(e){return e.substring(14).split(" ")},e$.parseRtpMap=function(e){let t=e.substring(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return i.name=(t=t[0].split("/"))[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},e$.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},e$.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},e$.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},e$.parseFmtp=function(e){let t,i={},s=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<s.length;e++)i[(t=s[e].trim().split("="))[0].trim()]=t[1];return i},e$.writeFmtp=function(e){let t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let s=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?s.push(t+"="+e.parameters[t]):s.push(t)}),t+="a=fmtp:"+i+" "+s.join(";")+"\r\n"}return t},e$.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},e$.writeRtcpFb=function(e){let t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},e$.parseSsrcMedia=function(e){let t=e.indexOf(" "),i={ssrc:parseInt(e.substring(7,t),10)},s=e.indexOf(":",t);return s>-1?(i.attribute=e.substring(t+1,s),i.value=e.substring(s+1)):i.attribute=e.substring(t+1),i},e$.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},e$.getMid=function(e){let t=e$.matchPrefix(e,"a=mid:")[0];if(t)return t.substring(6)},e$.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},e$.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:e$.matchPrefix(e+t,"a=fingerprint:").map(e$.parseFingerprint)}},e$.writeDtlsParameters=function(e,t){let i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},e$.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},e$.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?e$.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},e$.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},e$.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},e$.getCryptoParameters=function(e,t){return e$.matchPrefix(e+t,"a=crypto:").map(e$.parseCryptoLine)},e$.getIceParameters=function(e,t){let i=e$.matchPrefix(e+t,"a=ice-ufrag:")[0],s=e$.matchPrefix(e+t,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e$.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},e$.parseRtpParameters=function(e){let t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e$.splitLines(e)[0].split(" ");t.profile=i[2];for(let s=3;s<i.length;s++){let o=i[s],r=e$.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(r){let i=e$.parseRtpMap(r),s=e$.matchPrefix(e,"a=fmtp:"+o+" ");switch(i.parameters=s.length?e$.parseFmtp(s[0]):{},i.rtcpFeedback=e$.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(e$.parseRtcpFb),t.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(i.name.toUpperCase())}}}e$.matchPrefix(e,"a=extmap:").forEach(e=>{t.headerExtensions.push(e$.parseExtmap(e))});let s=e$.matchPrefix(e,"a=rtcp-fb:* ").map(e$.parseRtcpFb);return t.codecs.forEach(e=>{s.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),t},e$.writeRtpDescription=function(e,t){let i="";i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=t.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(e=>{i+=e$.writeRtpMap(e),i+=e$.writeFmtp(e),i+=e$.writeRtcpFb(e)});let s=0;return t.codecs.forEach(e=>{e.maxptime>s&&(s=e.maxptime)}),s>0&&(i+="a=maxptime:"+s+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(e=>{i+=e$.writeExtmap(e)}),i},e$.parseRtpEncodingParameters=function(e){let t,i=[],s=e$.parseRtpParameters(e),o=-1!==s.fecMechanisms.indexOf("RED"),r=-1!==s.fecMechanisms.indexOf("ULPFEC"),n=e$.matchPrefix(e,"a=ssrc:").map(e=>e$.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),a=n.length>0&&n[0].ssrc,c=e$.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));c.length>0&&c[0].length>1&&c[0][0]===a&&(t=c[0][1]),s.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let s={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&t&&(s.rtx={ssrc:t}),i.push(s),o&&((s=JSON.parse(JSON.stringify(s))).fec={ssrc:a,mechanism:r?"red+ulpfec":"red"},i.push(s))}}),0===i.length&&a&&i.push({ssrc:a});let p=e$.matchPrefix(e,"b=");return p.length&&(p=0===p[0].indexOf("b=TIAS:")?parseInt(p[0].substring(7),10):0===p[0].indexOf("b=AS:")?950*parseInt(p[0].substring(5),10)-16e3:void 0,i.forEach(e=>{e.maxBitrate=p})),i},e$.parseRtcpParameters=function(e){let t={},i=e$.matchPrefix(e,"a=ssrc:").map(e=>e$.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);let s=e$.matchPrefix(e,"a=rtcp-rsize");return t.reducedSize=s.length>0,t.compound=0===s.length,t.mux=e$.matchPrefix(e,"a=rtcp-mux").length>0,t},e$.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},e$.parseMsid=function(e){let t,i=e$.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(t=i[0].substring(7).split(" "))[0],track:t[1]};let s=e$.matchPrefix(e,"a=ssrc:").map(e=>e$.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);if(s.length>0)return{stream:(t=s[0].value.split(" "))[0],track:t[1]}},e$.parseSctpDescription=function(e){let t,i=e$.parseMLine(e),s=e$.matchPrefix(e,"a=max-message-size:");s.length>0&&(t=parseInt(s[0].substring(19),10)),isNaN(t)&&(t=65536);let o=e$.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:t};let r=e$.matchPrefix(e,"a=sctpmap:");if(r.length>0){let e=r[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:t}}},e$.writeSctpDescription=function(e,t){let i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},e$.generateSessionId=function(){return Math.random().toString().substr(2,22)},e$.writeSessionBoilerplate=function(e,t,i){return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||e$.generateSessionId())+" "+(void 0!==t?t:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},e$.getDirection=function(e,t){let i=e$.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substring(2)}return t?e$.getDirection(t):"sendrecv"},e$.getKind=function(e){return e$.splitLines(e)[0].split(" ")[0].substring(2)},e$.isRejected=function(e){return"0"===e.split(" ",2)[1]},e$.parseMLine=function(e){let t=e$.splitLines(e)[0].substring(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},e$.parseOLine=function(e){let t=e$.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},e$.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let t=e$.splitLines(e);for(let e=0;e<t.length;e++)if(t[e].length<2||"="!==t[e].charAt(1))return!1;return!0},eH=e$;const e1=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let i=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;let{navigator:i}=e;if(i.userAgentData&&i.userAgentData.brands){let e=i.userAgentData.brands.find(e=>"Chromium"===e.brand);if(e)return{browser:"chrome",version:parseInt(e.version,10)}}return i.mozGetUserMedia?(t.browser="firefox",t.version=parseInt(ei(i.userAgent,/Firefox\/(\d+)\./,1))):i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection?(t.browser="chrome",t.version=parseInt(ei(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2))):e.RTCPeerConnection&&i.userAgent.match(/AppleWebKit\/(\d+)\./)?(t.browser="safari",t.version=parseInt(ei(i.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=ei(i.userAgent,/Version\/(\d+(\.?\d+))/,1)):t.browser="Not a supported browser.",t}(e),s={browserDetails:i,commonShim:eG,extractVersion:ei,disableLog:eo,disableWarnings:er,sdp:eH};switch(i.browser){case"chrome":if(!el||!el.shimPeerConnection||!t.shimChrome){en("Chrome shim is not included in this adapter release.");break}if(null===i.version){en("Chrome shim can not determine version, not shimming.");break}en("adapter.js shimming chrome."),s.browserShim=el,eQ(e,i),eX(e,i),el.shimGetUserMedia(e,i),el.shimMediaStream(e,i),el.shimPeerConnection(e,i),el.shimOnTrack(e,i),el.shimAddTrackRemoveTrack(e,i),el.shimGetSendersWithDtmf(e,i),el.shimSenderReceiverGetStats(e,i),el.fixNegotiationNeeded(e,i),eY(e,i),eW(e,i),eq(e,i),eJ(e,i),eK(e,i),eZ(e,i);break;case"firefox":if(!e_||!e_.shimPeerConnection||!t.shimFirefox){en("Firefox shim is not included in this adapter release.");break}en("adapter.js shimming firefox."),s.browserShim=e_,eQ(e,i),eX(e,i),e_.shimGetUserMedia(e,i),e_.shimPeerConnection(e,i),e_.shimOnTrack(e,i),e_.shimRemoveStream(e,i),e_.shimSenderGetStats(e,i),e_.shimReceiverGetStats(e,i),e_.shimRTCDataChannel(e,i),e_.shimAddTransceiver(e,i),e_.shimGetParameters(e,i),e_.shimCreateOffer(e,i),e_.shimCreateAnswer(e,i),eY(e,i),eq(e,i),eJ(e,i),eK(e,i);break;case"safari":if(!eD||!t.shimSafari){en("Safari shim is not included in this adapter release.");break}en("adapter.js shimming safari."),s.browserShim=eD,eQ(e,i),eX(e,i),eD.shimRTCIceServerUrls(e,i),eD.shimCreateOfferLegacy(e,i),eD.shimCallbacksAPI(e,i),eD.shimLocalStreamsAPI(e,i),eD.shimRemoteStreamsAPI(e,i),eD.shimTrackEventTransceiver(e,i),eD.shimGetUserMedia(e,i),eD.shimAudioContext(e,i),eY(e,i),eW(e,i),eJ(e,i),eK(e,i),eZ(e,i);break;default:en("Unsupported browser!")}return s}({window:"undefined"==typeof window?void 0:window});function e0(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}var e5=function(e,t){this.type=e,this.data=t},e2=(o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),e3=function(e){function t(i){var s=e.call(this,i)||this;return Object.setPrototypeOf(s,Object.create(t.prototype)),Object.defineProperty(s,"name",{configurable:!0,enumerable:!1,value:t.name}),s}return e2(t,e),t}(Error);function e6(e,t,i){var s=Math.floor(i/0x100000000);e.setUint32(t,s),e.setUint32(t+4,i)}function e4(e,t){return 0x100000000*e.getInt32(t)+e.getUint32(t+4)}var e8={type:-1,encode:function(e){var t,i,s,o;return e instanceof Date?function(e){var t=e.sec,i=e.nsec;if(t>=0&&i>=0&&t<=0x3ffffffff)if(0===i&&t<=0xffffffff){var s=new Uint8Array(4),o=new DataView(s.buffer);return o.setUint32(0,t),s}else{var r=t/0x100000000,s=new Uint8Array(8),o=new DataView(s.buffer);return o.setUint32(0,i<<2|3&r),o.setUint32(4,0|t),s}var s=new Uint8Array(12),o=new DataView(s.buffer);return o.setUint32(0,i),e6(o,4,t),s}((i=Math.floor((t=e.getTime())/1e3),o=Math.floor((s=(t-1e3*i)*1e6)/1e9),{sec:i+o,nsec:s-1e9*o})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:var i=t.getUint32(0),s=0;return{sec:i,nsec:0};case 8:var o=t.getUint32(0),i=(3&o)*0x100000000+t.getUint32(4),s=o>>>2;return{sec:i,nsec:s};case 12:var i=e4(t,4),s=t.getUint32(0);return{sec:i,nsec:s};default:throw new e3("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},e7=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(e8)}return e.prototype.register=function(e){var t=e.type,i=e.encode,s=e.decode;if(t>=0)this.encoders[t]=i,this.decoders[t]=s;else{var o=1+t;this.builtInEncoders[o]=i,this.builtInDecoders[o]=s}},e.prototype.tryToEncode=function(e,t){for(var i=0;i<this.builtInEncoders.length;i++){var s=this.builtInEncoders[i];if(null!=s){var o=s(e,t);if(null!=o){var r=-1-i;return new e5(r,o)}}}for(var i=0;i<this.encoders.length;i++){var s=this.encoders[i];if(null!=s){var o=s(e,t);if(null!=o){var r=i;return new e5(r,o)}}}return e instanceof e5?e:null},e.prototype.decode=function(e,t,i){var s=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return s?s(e,t,i):new e5(t,e)},e.defaultCodec=new e,e}(),e9="undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function te(e){for(var t=e.length,i=0,s=0;s<t;){var o=e.charCodeAt(s++);if((0xffffff80&o)==0){i++;continue}if((0xfffff800&o)==0)i+=2;else{if(o>=55296&&o<=56319&&s<t){var r=e.charCodeAt(s);(64512&r)==56320&&(++s,o=((1023&o)<<10)+(1023&r)+65536)}(0xffff0000&o)==0?i+=3:i+=4}}return i}var tt=e9?new TextEncoder:void 0,ti=0xffffffff*!e9,ts=(null==tt?void 0:tt.encodeInto)?function(e,t,i){tt.encodeInto(e,t.subarray(i))}:function(e,t,i){t.set(tt.encode(e),i)};function to(e,t,i){for(var s=t,o=s+i,r=[],n="";s<o;){var a=e[s++];if((128&a)==0)r.push(a);else if((224&a)==192){var c=63&e[s++];r.push((31&a)<<6|c)}else if((240&a)==224){var c=63&e[s++],p=63&e[s++];r.push((31&a)<<12|c<<6|p)}else if((248&a)==240){var c=63&e[s++],p=63&e[s++],l=(7&a)<<18|c<<12|p<<6|63&e[s++];l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l)}else r.push(a);r.length>=4096&&(n+=String.fromCharCode.apply(String,r),r.length=0)}return r.length>0&&(n+=String.fromCharCode.apply(String,r)),n}var tr=e9?new TextDecoder:null,tn=0xffffffff*!e9;function ta(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}var tc=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var i=0;i<this.maxKeyLength;i++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,i){var s=this.caches[i-1];e:for(var o=0;o<s.length;o++){for(var r=s[o],n=r.bytes,a=0;a<i;a++)if(n[a]!==e[t+a])continue e;return r.str}return null},e.prototype.store=function(e,t){var i=this.caches[e.length-1],s={bytes:e,str:t};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=s:i.push(s)},e.prototype.decode=function(e,t,i){var s=this.find(e,t,i);if(null!=s)return this.hit++,s;this.miss++;var o=to(e,t,i),r=Uint8Array.prototype.slice.call(e,t,t+i);return this.store(r,o),o},e}(),tp=function(e,t){var i,s,o,r,n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){var c=[r,a];if(i)throw TypeError("Generator is already executing.");for(;n;)try{if(i=1,s&&(o=2&c[0]?s.return:c[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,c[1])).done)return o;switch(s=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,s=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(!(o=(o=n.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){n=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){n.label=c[1];break}if(6===c[0]&&n.label<o[1]){n.label=o[1],o=c;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(c);break}o[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(e){c=[6,e],s=0}finally{i=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},tl=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(i){t[i]=e[i]&&function(t){return new Promise(function(s,o){var r,n,a;r=s,n=o,a=(t=e[i](t)).done,Promise.resolve(t.value).then(function(e){r({value:e,done:a})},n)})}}},th=function(e){return this instanceof th?(this.v=e,this):new th(e)},td=function(e,t,i){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=i.apply(e,t||[]),r=[];return s={},n("next"),n("throw"),n("return"),s[Symbol.asyncIterator]=function(){return this},s;function n(e){o[e]&&(s[e]=function(t){return new Promise(function(i,s){r.push([e,t,i,s])>1||a(e,t)})})}function a(e,t){try{var i;(i=o[e](t)).value instanceof th?Promise.resolve(i.value.v).then(c,p):l(r[0][2],i)}catch(e){l(r[0][3],e)}}function c(e){a("next",e)}function p(e){a("throw",e)}function l(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}},ty=function(e){var t=typeof e;return"string"===t||"number"===t},tu=new DataView(new ArrayBuffer(0)),tf=new Uint8Array(tu.buffer),tg=function(){try{tu.getInt8(0)}catch(e){return e.constructor}throw Error("never reached")}(),tm=new tg("Insufficient data"),tb=new tc;function tx(e,t,i,s,o,r,n,a){void 0===e&&(e=e7.defaultCodec),void 0===t&&(t=void 0),void 0===i&&(i=0xffffffff),void 0===s&&(s=0xffffffff),void 0===o&&(o=0xffffffff),void 0===r&&(r=0xffffffff),void 0===n&&(n=0xffffffff),void 0===a&&(a=tb),this.extensionCodec=e,this.context=t,this.maxStrLength=i,this.maxBinLength=s,this.maxArrayLength=o,this.maxMapLength=r,this.maxExtLength=n,this.keyDecoder=a,this.totalPos=0,this.pos=0,this.view=tu,this.bytes=tf,this.headByte=-1,this.stack=[]}function t_(e,t,i,s,o,r,n,a){void 0===e&&(e=e7.defaultCodec),void 0===t&&(t=void 0),void 0===i&&(i=100),void 0===s&&(s=2048),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===a&&(a=!1),this.extensionCodec=e,this.context=t,this.maxDepth=i,this.initialBufferSize=s,this.sortKeys=o,this.forceFloat32=r,this.ignoreUndefined=n,this.forceIntegerToFloat=a,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}function tw(e,t,i,s){Object.defineProperty(e,t,{get:i,set:s,enumerable:!0,configurable:!0})}tx.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},tx.prototype.setBuffer=function(e){this.bytes=ta(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=ta(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},tx.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),i=ta(e),s=new Uint8Array(t.length+i.length);s.set(t),s.set(i,t.length),this.setBuffer(s)}else this.setBuffer(e)},tx.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},tx.prototype.createExtraByteError=function(e){var t=this.view,i=this.pos;return RangeError("Extra ".concat(t.byteLength-i," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},tx.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},tx.prototype.decodeMulti=function(e){return tp(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return t.sent(),[3,1];case 3:return[2]}})},tx.prototype.decodeAsync=function(e){var t,i,s,o,r,n,a,c;return r=this,n=void 0,a=void 0,c=function(){var r,n,a,c,p,l,h;return tp(this,function(d){switch(d.label){case 0:r=!1,d.label=1;case 1:d.trys.push([1,6,7,12]),t=tl(e),d.label=2;case 2:return[4,t.next()];case 3:if((i=d.sent()).done)return[3,5];if(a=i.value,r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),r=!0}catch(e){if(!(e instanceof tg))throw e}this.totalPos+=this.pos,d.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return s={error:d.sent()},[3,12];case 7:if(d.trys.push([7,,10,11]),!(i&&!i.done&&(o=t.return)))return[3,9];return[4,o.call(t)];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(s)throw s.error;return[7];case 11:return[7];case 12:if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,n]}throw c=this,p=c.headByte,l=c.pos,h=c.totalPos,RangeError("Insufficient data in parsing ".concat(e0(p)," at ").concat(h," (").concat(l," in the current buffer)"))}})},new(a||(a=Promise))(function(e,t){function i(e){try{o(c.next(e))}catch(e){t(e)}}function s(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):((o=t.value)instanceof a?o:new a(function(e){e(o)})).then(i,s)}o((c=c.apply(r,n||[])).next())})},tx.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},tx.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},tx.prototype.decodeMultiAsync=function(e,t){return td(this,arguments,function(){var i,s,o,r,n,a,c,p;return tp(this,function(l){switch(l.label){case 0:i=t,s=-1,l.label=1;case 1:l.trys.push([1,13,14,19]),o=tl(e),l.label=2;case 2:return[4,th(o.next())];case 3:if((r=l.sent()).done)return[3,12];if(n=r.value,t&&0===s)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(s=this.readArraySize(),i=!1,this.complete()),l.label=4;case 4:l.trys.push([4,9,,10]),l.label=5;case 5:return[4,th(this.doDecodeSync())];case 6:return[4,l.sent()];case 7:if(l.sent(),0==--s)return[3,8];return[3,5];case 8:return[3,10];case 9:if(!((a=l.sent())instanceof tg))throw a;return[3,10];case 10:this.totalPos+=this.pos,l.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c={error:l.sent()},[3,19];case 14:if(l.trys.push([14,,17,18]),!(r&&!r.done&&(p=o.return)))return[3,16];return[4,th(p.call(o))];case 15:l.sent(),l.label=16;case 16:return[3,18];case 17:if(c)throw c.error;return[7];case 18:return[7];case 19:return[2]}})})},tx.prototype.doDecodeSync=function(){t:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var i=e-128;if(0!==i){this.pushMapState(i),this.complete();continue}t={}}else if(e<160){var i=e-144;if(0!==i){this.pushArrayState(i),this.complete();continue}t=[]}else{var s=e-160;t=this.decodeUtf8String(s,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.readI64();else if(217===e){var s=this.lookU8();t=this.decodeUtf8String(s,1)}else if(218===e){var s=this.lookU16();t=this.decodeUtf8String(s,2)}else if(219===e){var s=this.lookU32();t=this.decodeUtf8String(s,4)}else if(220===e){var i=this.readU16();if(0!==i){this.pushArrayState(i),this.complete();continue}t=[]}else if(221===e){var i=this.readU32();if(0!==i){this.pushArrayState(i),this.complete();continue}t=[]}else if(222===e){var i=this.readU16();if(0!==i){this.pushMapState(i),this.complete();continue}t={}}else if(223===e){var i=this.readU32();if(0!==i){this.pushMapState(i),this.complete();continue}t={}}else if(196===e){var i=this.lookU8();t=this.decodeBinary(i,1)}else if(197===e){var i=this.lookU16();t=this.decodeBinary(i,2)}else if(198===e){var i=this.lookU32();t=this.decodeBinary(i,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){var i=this.lookU8();t=this.decodeExtension(i,1)}else if(200===e){var i=this.lookU16();t=this.decodeExtension(i,2)}else if(201===e){var i=this.lookU32();t=this.decodeExtension(i,4)}else throw new e3("Unrecognized type byte: ".concat(e0(e)));this.complete();for(var o=this.stack;o.length>0;){var r=o[o.length-1];if(0===r.type)if(r.array[r.position]=t,r.position++,r.position===r.size)o.pop(),t=r.array;else continue t;else if(1===r.type){if(!ty(t))throw new e3("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new e3("The key __proto__ is not allowed");r.key=t,r.type=2;continue t}else if(r.map[r.key]=t,r.readCount++,r.readCount===r.size)o.pop(),t=r.map;else{r.key=null,r.type=1;continue t}}return t}},tx.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},tx.prototype.complete=function(){this.headByte=-1},tx.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new e3("Unrecognized array type byte: ".concat(e0(e)))}},tx.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new e3("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},tx.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new e3("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:Array(e),position:0})},tx.prototype.decodeUtf8String=function(e,t){if(e>this.maxStrLength)throw new e3("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw tm;var i,s,o,r,n=this.pos+t;return this.stateIsMapKey()&&(null==(o=this.keyDecoder)?void 0:o.canBeCached(e))?r=this.keyDecoder.decode(this.bytes,n,e):e>tn?(i=this.bytes,s=i.subarray(n,n+e),r=tr.decode(s)):r=to(this.bytes,n,e),this.pos+=t+e,r},tx.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},tx.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new e3("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw tm;var i=this.pos+t,s=this.bytes.subarray(i,i+e);return this.pos+=t+e,s},tx.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new e3("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var i=this.view.getInt8(this.pos+t),s=this.decodeBinary(e,t+1);return this.extensionCodec.decode(s,i,this.context)},tx.prototype.lookU8=function(){return this.view.getUint8(this.pos)},tx.prototype.lookU16=function(){return this.view.getUint16(this.pos)},tx.prototype.lookU32=function(){return this.view.getUint32(this.pos)},tx.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},tx.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},tx.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},tx.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},tx.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},tx.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},tx.prototype.readU64=function(){var e,t,i=(e=this.view,t=this.pos,0x100000000*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,i},tx.prototype.readI64=function(){var e=e4(this.view,this.pos);return this.pos+=8,e},tx.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},tx.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},t_.prototype.reinitializeState=function(){this.pos=0},t_.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},t_.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},t_.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)},t_.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},t_.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),i=new Uint8Array(t),s=new DataView(t);i.set(this.bytes),this.view=s,this.bytes=i},t_.prototype.encodeNil=function(){this.writeU8(192)},t_.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},t_.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<0x100000000?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-0x80000000?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},t_.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<0x100000000)this.writeU8(219),this.writeU32(e);else throw Error("Too long string: ".concat(e," bytes in UTF-8"))},t_.prototype.encodeString=function(e){if(e.length>ti){var t=te(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),ts(e,this.bytes,this.pos),this.pos+=t}else{var t=te(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,i){for(var s=e.length,o=i,r=0;r<s;){var n=e.charCodeAt(r++);if((0xffffff80&n)==0){t[o++]=n;continue}if((0xfffff800&n)==0)t[o++]=n>>6&31|192;else{if(n>=55296&&n<=56319&&r<s){var a=e.charCodeAt(r);(64512&a)==56320&&(++r,n=((1023&n)<<10)+(1023&a)+65536)}(0xffff0000&n)==0?t[o++]=n>>12&15|224:(t[o++]=n>>18&7|240,t[o++]=n>>12&63|128),t[o++]=n>>6&63|128}t[o++]=63&n|128}}(e,this.bytes,this.pos),this.pos+=t}},t_.prototype.encodeObject=function(e,t){var i=this.extensionCodec.tryToEncode(e,this.context);if(null!=i)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if("object"==typeof e)this.encodeMap(e,t);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},t_.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<0x100000000)this.writeU8(198),this.writeU32(t);else throw Error("Too large binary: ".concat(t));var i=ta(e);this.writeU8a(i)},t_.prototype.encodeArray=function(e,t){var i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<0x100000000)this.writeU8(221),this.writeU32(i);else throw Error("Too large array: ".concat(i));for(var s=0;s<e.length;s++){var o=e[s];this.doEncode(o,t+1)}},t_.prototype.countWithoutUndefined=function(e,t){for(var i=0,s=0;s<t.length;s++)void 0!==e[t[s]]&&i++;return i},t_.prototype.encodeMap=function(e,t){var i=Object.keys(e);this.sortKeys&&i.sort();var s=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<0x100000000)this.writeU8(223),this.writeU32(s);else throw Error("Too large map object: ".concat(s));for(var o=0;o<i.length;o++){var r=i[o],n=e[r];this.ignoreUndefined&&void 0===n||(this.encodeString(r),this.doEncode(n,t+1))}},t_.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<0x100000000)this.writeU8(201),this.writeU32(t);else throw Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},t_.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},t_.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},t_.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},t_.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},t_.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},t_.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},t_.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},t_.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},t_.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},t_.prototype.writeU64=function(e){var t,i;this.ensureBufferSizeToWrite(8),t=this.view,i=this.pos,t.setUint32(i,e/0x100000000),t.setUint32(i+4,e),this.pos+=8},t_.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),e6(this.view,this.pos,e),this.pos+=8};class tv{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{let t=[],i=e.byteLength,s=Math.ceil(i/this.chunkedMTU),o=0,r=0;for(;r<i;){let n=Math.min(i,r+this.chunkedMTU),a=e.slice(r,n),c={__peerData:this._dataCount,n:o,data:a,total:s};t.push(c),r=n,o++}return this._dataCount++,t}}}const tC=e1.default||e1,tS=new class{isWebRTCSupported(){return"undefined"!=typeof RTCPeerConnection}isBrowserSupported(){let e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&!this.isIOS&&t>=this.minSafariVersion)}getBrowser(){return tC.browserDetails.browser}getVersion(){return tC.browserDetails.version||0}isUnifiedPlanSupported(){let e,t=this.getBrowser(),i=tC.browserDetails.version||0;if("chrome"===t&&i<this.minChromeVersion)return!1;if("firefox"===t&&i>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let s=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),s=!0}catch(e){}finally{e&&e.close()}return s}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS="undefined"!=typeof navigator&&["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},tk=e=>!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e),tE=()=>Math.random().toString(36).slice(2),tR={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},tT=new class extends tv{noop(){}blobToArrayBuffer(e,t){let i=new FileReader;return i.onload=function(e){e.target&&t(e.target.result)},i.readAsArrayBuffer(e),i}binaryStringToArrayBuffer(e){let t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer}isSecure(){return"https:"===location.protocol}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=tR,this.browser=tS.getBrowser(),this.browserVersion=tS.getVersion(),this.pack=Z,this.unpack=q,this.supports=function(){let e,t={browser:tS.isBrowserSupported(),webRTC:tS.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{let i;e=new RTCPeerConnection(tR),t.audioVideo=!0;try{i=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!i.ordered;try{i.binaryType="blob",t.binaryBlob=!tS.isIOS}catch(e){}}catch(e){}finally{i&&i.close()}}catch(e){}finally{e&&e.close()}return t}(),this.validateId=tk,this.randomToken=tE}};var tP=new class{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){let i=["PeerJS: ",...t];for(let e in i)i[e]instanceof Error&&(i[e]="("+i[e].name+") "+i[e].message);e>=3?console.log(...i):e>=2?console.warn("WARNING",...i):e>=1&&console.error("ERROR",...i)}constructor(){this._logLevel=0}},tM={},tI=Object.prototype.hasOwnProperty,tV="~";function tD(){}function tB(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function tA(e,t,i,s,o){if("function"!=typeof i)throw TypeError("The listener must be a function");var r=new tB(i,s||e,o),n=tV?tV+t:t;return e._events[n]?e._events[n].fn?e._events[n]=[e._events[n],r]:e._events[n].push(r):(e._events[n]=r,e._eventsCount++),e}function tL(e,t){0==--e._eventsCount?e._events=new tD:delete e._events[t]}function tU(){this._events=new tD,this._eventsCount=0}Object.create&&(tD.prototype=Object.create(null),new tD().__proto__||(tV=!1)),tU.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)tI.call(e,t)&&i.push(tV?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},tU.prototype.listeners=function(e){var t=tV?tV+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,o=i.length,r=Array(o);s<o;s++)r[s]=i[s].fn;return r},tU.prototype.listenerCount=function(e){var t=tV?tV+e:e,i=this._events[t];return i?i.fn?1:i.length:0},tU.prototype.emit=function(e,t,i,s,o,r){var n=tV?tV+e:e;if(!this._events[n])return!1;var a,c,p=this._events[n],l=arguments.length;if(p.fn){switch(p.once&&this.removeListener(e,p.fn,void 0,!0),l){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,t),!0;case 3:return p.fn.call(p.context,t,i),!0;case 4:return p.fn.call(p.context,t,i,s),!0;case 5:return p.fn.call(p.context,t,i,s,o),!0;case 6:return p.fn.call(p.context,t,i,s,o,r),!0}for(c=1,a=Array(l-1);c<l;c++)a[c-1]=arguments[c];p.fn.apply(p.context,a)}else{var h,d=p.length;for(c=0;c<d;c++)switch(p[c].once&&this.removeListener(e,p[c].fn,void 0,!0),l){case 1:p[c].fn.call(p[c].context);break;case 2:p[c].fn.call(p[c].context,t);break;case 3:p[c].fn.call(p[c].context,t,i);break;case 4:p[c].fn.call(p[c].context,t,i,s);break;default:if(!a)for(h=1,a=Array(l-1);h<l;h++)a[h-1]=arguments[h];p[c].fn.apply(p[c].context,a)}}return!0},tU.prototype.on=function(e,t,i){return tA(this,e,t,i,!1)},tU.prototype.once=function(e,t,i){return tA(this,e,t,i,!0)},tU.prototype.removeListener=function(e,t,i,s){var o=tV?tV+e:e;if(!this._events[o])return this;if(!t)return tL(this,o),this;var r=this._events[o];if(r.fn)r.fn!==t||s&&!r.once||i&&r.context!==i||tL(this,o);else{for(var n=0,a=[],c=r.length;n<c;n++)(r[n].fn!==t||s&&!r[n].once||i&&r[n].context!==i)&&a.push(r[n]);a.length?this._events[o]=1===a.length?a[0]:a:tL(this,o)}return this},tU.prototype.removeAllListeners=function(e){var t;return e?(t=tV?tV+e:e,this._events[t]&&tL(this,t)):(this._events=new tD,this._eventsCount=0),this},tU.prototype.off=tU.prototype.removeListener,tU.prototype.addListener=tU.prototype.on,tU.prefixed=tV,tU.EventEmitter=tU,tM=tU;var tO={};tw(tO,"ConnectionType",()=>tF),tw(tO,"PeerErrorType",()=>tj),tw(tO,"BaseConnectionErrorType",()=>tz),tw(tO,"DataConnectionErrorType",()=>tN),tw(tO,"SerializationType",()=>tG),tw(tO,"SocketEventType",()=>tH),tw(tO,"ServerMessageType",()=>t$);var tF=((r={}).Data="data",r.Media="media",r),tj=((n={}).BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc",n),tz=((a={}).NegotiationFailed="negotiation-failed",a.ConnectionClosed="connection-closed",a),tN=((c={}).NotOpenYet="not-open-yet",c.MessageToBig="message-too-big",c),tG=((p={}).Binary="binary",p.BinaryUTF8="binary-utf8",p.JSON="json",p.None="raw",p),tH=((l={}).Message="message",l.Disconnected="disconnected",l.Error="error",l.Close="close",l),t$=((h={}).Heartbeat="HEARTBEAT",h.Candidate="CANDIDATE",h.Offer="OFFER",h.Answer="ANSWER",h.Open="OPEN",h.Error="ERROR",h.IdTaken="ID-TAKEN",h.InvalidKey="INVALID-KEY",h.Leave="LEAVE",h.Expire="EXPIRE",h);const tY="1.5.5";class tW extends tM.EventEmitter{constructor(e,t,i,s,o,r=5e3){super(),this.pingInterval=r,this._disconnected=!0,this._messagesQueue=[],this._baseUrl=(e?"wss://":"ws://")+t+":"+i+s+"peerjs?key="+o}start(e,t){this._id=e;let i=`${this._baseUrl}&id=${e}&token=${t}`;!this._socket&&this._disconnected&&(this._socket=new WebSocket(i+"&version="+tY),this._disconnected=!1,this._socket.onmessage=e=>{let t;try{t=JSON.parse(e.data),tP.log("Server message received:",t)}catch(t){tP.log("Invalid server message",e.data);return}this.emit(tH.Message,t)},this._socket.onclose=e=>{this._disconnected||(tP.log("Socket closed.",e),this._cleanup(),this._disconnected=!0,this.emit(tH.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),tP.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen())return void tP.log("Cannot send heartbeat, because socket closed");let e=JSON.stringify({type:t$.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&1===this._socket.readyState}_sendQueuedMessages(){let e=[...this._messagesQueue];for(let t of(this._messagesQueue=[],e))this.send(t)}send(e){if(this._disconnected)return;if(!this._id)return void this._messagesQueue.push(e);if(!e.type)return void this.emit(tH.Error,"Invalid message");if(!this._wsOpen())return;let t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class tJ{constructor(e){this.connection=e}startConnection(e){let t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===tF.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){let i=this.connection,s={ordered:!!e.reliable},o=t.createDataChannel(i.label,s);i._initializeDataChannel(o),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){tP.log("Creating RTCPeerConnection.");let e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){let t=this.connection.peer,i=this.connection.connectionId,s=this.connection.type,o=this.connection.provider;tP.log("Listening for ICE candidates."),e.onicecandidate=e=>{e.candidate&&e.candidate.candidate&&(tP.log(`Received ICE candidates for ${t}:`,e.candidate),o.socket.send({type:t$.Candidate,payload:{candidate:e.candidate,type:s,connectionId:i},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":tP.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(tz.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":tP.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(tz.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":tP.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{}}this.connection.emit("iceStateChanged",e.iceConnectionState)},tP.log("Listening for data channel"),e.ondatachannel=e=>{tP.log("Received data channel");let s=e.channel;o.getConnection(t,i)._initializeDataChannel(s)},tP.log("Listening for remote stream"),e.ontrack=e=>{tP.log("Received remote stream");let s=e.streams[0],r=o.getConnection(t,i);r.type===tF.Media&&this._addStreamToMediaConnection(s,r)}}cleanup(){tP.log("Cleaning up PeerConnection to "+this.connection.peer);let e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};let t="closed"!==e.signalingState,i=!1,s=this.connection.dataChannel;s&&(i=!!s.readyState&&"closed"!==s.readyState),(t||i)&&e.close()}async _makeOffer(){let e=this.connection.peerConnection,t=this.connection.provider;try{let i=await e.createOffer(this.connection.options.constraints);tP.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp);try{await e.setLocalDescription(i),tP.log("Set localDescription:",i,`for:${this.connection.peer}`);let s={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===tF.Data){let e=this.connection;s={...s,label:e.label,reliable:e.reliable,serialization:e.serialization}}t.socket.send({type:t$.Offer,payload:s,dst:this.connection.peer})}catch(e){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=e&&(t.emitError(tj.WebRTC,e),tP.log("Failed to setLocalDescription, ",e))}}catch(e){t.emitError(tj.WebRTC,e),tP.log("Failed to createOffer, ",e)}}async _makeAnswer(){let e=this.connection.peerConnection,t=this.connection.provider;try{let i=await e.createAnswer();tP.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp);try{await e.setLocalDescription(i),tP.log("Set localDescription:",i,`for:${this.connection.peer}`),t.socket.send({type:t$.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(e){t.emitError(tj.WebRTC,e),tP.log("Failed to setLocalDescription, ",e)}}catch(e){t.emitError(tj.WebRTC,e),tP.log("Failed to create answer, ",e)}}async handleSDP(e,t){t=new RTCSessionDescription(t);let i=this.connection.peerConnection,s=this.connection.provider;tP.log("Setting remote description",t);try{await i.setRemoteDescription(t),tP.log(`Set remoteDescription:${e} for:${this.connection.peer}`),"OFFER"===e&&await this._makeAnswer()}catch(e){s.emitError(tj.WebRTC,e),tP.log("Failed to setRemoteDescription, ",e)}}async handleCandidate(e){tP.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),tP.log(`Added ICE candidate for:${this.connection.peer}`)}catch(e){this.connection.provider.emitError(tj.WebRTC,e),tP.log("Failed to handleCandidate, ",e)}}_addTracksToConnection(e,t){if(tP.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return tP.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(i=>{t.addTrack(i,e)})}_addStreamToMediaConnection(e,t){tP.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class tK extends tM.EventEmitter{emitError(e,t){tP.error("Error:",t),this.emit("error",new tq(`${e}`,t))}}class tq extends Error{constructor(e,t){"string"==typeof t?super(t):(super(),Object.assign(this,t)),this.type=e}}class tZ extends tK{get open(){return this._open}constructor(e,t,i){super(),this.peer=e,this.provider=t,this.options=i,this._open=!1,this.metadata=i.metadata}}class tQ extends tZ{static #e=this.ID_PREFIX="mc_";get type(){return tF.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,i){super(e,t,i),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||tQ.ID_PREFIX+tT.randomToken(),this._negotiator=new tJ(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{tP.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{tP.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){tP.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){let t=e.type,i=e.payload;switch(e.type){case t$.Answer:this._negotiator.handleSDP(t,i.sdp),this._open=!0;break;case t$.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:tP.warn(`Unrecognized message type:${t} from peer:${this.peer}`)}}answer(e,t={}){if(this._localStream)return void tP.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");for(let i of(this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e}),this.provider._getMessages(this.connectionId)))this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class tX{constructor(e){this._options=e}_buildRequest(e){let t=this._options.secure?"https":"http",{host:i,port:s,path:o,key:r}=this._options,n=new URL(`${t}://${i}:${s}${o}${r}/${e}`);return n.searchParams.set("ts",`${Date.now()}${Math.random()}`),n.searchParams.set("version",tY),fetch(n.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{let e=await this._buildRequest("id");if(200!==e.status)throw Error(`Error. Status:${e.status}`);return e.text()}catch(t){tP.error("Error retrieving ID",t);let e="";throw"/"===this._options.path&&this._options.host!==tT.CLOUD_HOST&&(e=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),Error("Could not get an ID from the server."+e)}}async listAllPeers(){try{let e=await this._buildRequest("peers");if(200!==e.status){if(401===e.status){let e="";throw e=this._options.host===tT.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",Error("It doesn't look like you have permission to list peers IDs. "+e)}throw Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw tP.error("Error retrieving list peers",e),Error("Could not get list peers from the server."+e)}}}class t1 extends tZ{static #e=this.ID_PREFIX="dc_";static #t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return tF.Data}constructor(e,t,i){super(e,t,i),this.connectionId=this.options.connectionId||t1.ID_PREFIX+tE(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new tJ(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{tP.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=e=>{tP.log(`DC#${this.connectionId} dc onmessage:`,e.data)},this.dataChannel.onclose=()=>{tP.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush)return void this.send({__peerData:{type:"close"}});this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){return this.open?this._send(e,t):void this.emitError(tN.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.")}async handleMessage(e){let t=e.payload;switch(e.type){case t$.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case t$.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:tP.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}}}class t0 extends t1{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",e=>this._handleDataMessage(e))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t1.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(e){return tP.error(`DC#:${this.connectionId} Error when sending:`,e),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||0===this._buffer.length)return;let e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush)return void this.send({__peerData:{type:"close"}});this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class t5 extends t0{close(e){super.close(e),this._chunkedData={}}constructor(e,t,i){super(e,t,i),this.chunker=new tv,this.serialization=tG.Binary,this._chunkedData={}}_handleDataMessage({data:e}){let t=q(e),i=t.__peerData;if(i)return"close"===i.type?void this.close():void this._handleChunk(t);this.emit("data",t)}_handleChunk(e){let t=e.__peerData,i=this._chunkedData[t]||{data:[],count:0,total:e.total};if(i.data[e.n]=new Uint8Array(e.data),i.count++,this._chunkedData[t]=i,i.total===i.count){delete this._chunkedData[t];let e=function(e){let t=0;for(let i of e)t+=i.byteLength;let i=new Uint8Array(t),s=0;for(let t of e)i.set(t,s),s+=t.byteLength;return i}(i.data);this._handleDataMessage({data:e})}}_send(e,t){let i=Z(e);return i instanceof Promise?this._send_blob(i):!t&&i.byteLength>this.chunker.chunkedMTU?void this._sendChunks(i):void this._bufferedSend(i)}async _send_blob(e){let t=await e;if(t.byteLength>this.chunker.chunkedMTU)return void this._sendChunks(t);this._bufferedSend(t)}_sendChunks(e){let t=this.chunker.chunk(e);for(let e of(tP.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`),t))this.send(e,!0)}}class t2 extends t0{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=tG.None}}class t3 extends t0{_handleDataMessage({data:e}){let t=this.parse(this.decoder.decode(e)),i=t.__peerData;if(i&&"close"===i.type)return void this.close();this.emit("data",t)}_send(e,t){let i=this.encoder.encode(this.stringify(e));if(i.byteLength>=tT.chunkedMTU)return void this.emitError(tN.MessageToBig,"Message too big for JSON channel");this._bufferedSend(i)}constructor(...e){super(...e),this.serialization=tG.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class t6 extends tK{static #e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){let e=Object.create(null);for(let[t,i]of this._connections)e[t]=i;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){let i;if(super(),this._serializers={raw:t2,json:t3,binary:t5,"binary-utf8":t5,default:t5},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map,e&&e.constructor==Object?t=e:e&&(i=e.toString()),t={debug:0,host:tT.CLOUD_HOST,port:tT.CLOUD_PORT,path:"/",key:t6.DEFAULT_KEY,token:tT.randomToken(),config:tT.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},"/"===this._options.host&&(this._options.host=window.location.hostname),this._options.path&&("/"!==this._options.path[0]&&(this._options.path="/"+this._options.path),"/"!==this._options.path[this._options.path.length-1]&&(this._options.path+="/")),void 0===this._options.secure&&this._options.host!==tT.CLOUD_HOST?this._options.secure=tT.isSecure():this._options.host==tT.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&tP.setLogFunction(this._options.logFunction),tP.logLevel=this._options.debug||0,this._api=new tX(t),this._socket=this._createServerConnection(),!tT.supports.audioVideo&&!tT.supports.data)return void this._delayedAbort(tj.BrowserIncompatible,"The current browser does not support WebRTC");if(i&&!tT.validateId(i))return void this._delayedAbort(tj.InvalidID,`ID "${i}" is invalid`);i?this._initialize(i):this._api.retrieveId().then(e=>this._initialize(e)).catch(e=>this._abort(tj.ServerError,e))}_createServerConnection(){let e=new tW(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(tH.Message,e=>{this._handleMessage(e)}),e.on(tH.Error,e=>{this._abort(tj.SocketError,e)}),e.on(tH.Disconnected,()=>{this.disconnected||(this.emitError(tj.Network,"Lost connection to server."),this.disconnect())}),e.on(tH.Close,()=>{this.disconnected||this._abort(tj.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){let t=e.type,i=e.payload,s=e.src;switch(t){case t$.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case t$.Error:this._abort(tj.ServerError,i.msg);break;case t$.IdTaken:this._abort(tj.UnavailableID,`ID "${this.id}" is taken`);break;case t$.InvalidKey:this._abort(tj.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case t$.Leave:tP.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case t$.Expire:this.emitError(tj.PeerUnavailable,`Could not connect to peer ${s}`);break;case t$.Offer:{let e=i.connectionId,t=this.getConnection(s,e);if(t&&(t.close(),tP.warn(`Offer received for existing Connection ID:${e}`)),i.type===tF.Media){let o=new tQ(s,this,{connectionId:e,_payload:i,metadata:i.metadata});t=o,this._addConnection(s,t),this.emit("call",o)}else{if(i.type!==tF.Data)return void tP.warn(`Received malformed connection type:${i.type}`);let o=new this._serializers[i.serialization](s,this,{connectionId:e,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable});t=o,this._addConnection(s,t),this.emit("connection",o)}for(let i of this._getMessages(e))t.handleMessage(i);break}default:{if(!i)return void tP.warn(`You received a malformed message from ${s} of type ${t}`);let o=i.connectionId,r=this.getConnection(s,o);r&&r.peerConnection?r.handleMessage(e):o?this._storeMessage(o,e):tP.warn("You received an unrecognized message:",e)}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){let t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){tP.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(tj.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}let i=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,i),i}call(e,t,i={}){if(this.disconnected){tP.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(tj.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t)return void tP.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");let s=new tQ(e,this,{...i,_stream:t});return this._addConnection(e,s),s}_addConnection(e,t){tP.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){let t=this._connections.get(e.peer);if(t){let i=t.indexOf(e);-1!==i&&t.splice(i,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){let i=this._connections.get(e);if(!i)return null;for(let e of i)if(e.connectionId===t)return e;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){tP.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(tP.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(let e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){let t=this._connections.get(e);if(t)for(let e of t)e.close()}disconnect(){if(this.disconnected)return;let e=this.id;tP.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)tP.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else if(this.destroyed)throw Error("This peer cannot reconnect to the server. It has already been destroyed.");else if(this.disconnected||this.open)throw Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`);else tP.error("In a hurry? We're still trying to make the initial connection!")}listAllPeers(e=e=>{}){this._api.listAllPeers().then(t=>e(t)).catch(e=>this._abort(tj.ServerError,e))}}class t4{static{this.logs=[]}static{this.maxLogs=1e3}static{this.storageKey="roulette_multiplayer_logs"}static debug(e,t,i){this.log("DEBUG",e,t,i)}static info(e,t,i){this.log("INFO",e,t,i)}static warn(e,t,i){this.log("WARN",e,t,i)}static error(e,t,i){this.log("ERROR",e,t,void 0,i)}static log(e,t,i,s,o){let r={timestamp:Date.now(),level:e,module:t,message:i,data:s,error:o?{name:o.name,message:o.message,stack:o.stack}:void 0};this.logs.push(r),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs)),this.saveToStorage(),this.printToConsole(r)}static saveToStorage(){try{let e=this.logs.slice(-100);localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){}}static printToConsole(e){let t=new Date(e.timestamp).toLocaleTimeString("ko-KR"),i=`[${t}] [${e.module}]`;switch(e.level){case"DEBUG":console.debug(i,e.message,e.data||"");break;case"INFO":console.log(i,e.message,e.data||"");break;case"WARN":console.warn(i,e.message,e.data||"");break;case"ERROR":console.error(i,e.message,e.error||e.data||"")}}static exportLogs(){return JSON.stringify(this.logs,null,2)}static downloadLogs(e){let t=`roulette-logs-${Date.now()}.json`,i=new Blob([this.exportLogs()],{type:"application/json"}),s=URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=e||t,o.click(),URL.revokeObjectURL(s)}static clearLogs(){this.logs=[];try{localStorage.removeItem(this.storageKey)}catch(e){}console.log("[Logger] 로그가 클리어되었습니다.")}static loadFromStorage(){try{let e=localStorage.getItem(this.storageKey);e&&(this.logs=JSON.parse(e),console.log(`[Logger] ${this.logs.length}\u{AC1C}\u{C758} \u{B85C}\u{ADF8}\u{B97C} \u{BD88}\u{B7EC}\u{C654}\u{C2B5}\u{B2C8}\u{B2E4}.`))}catch(e){console.error("[Logger] 로그 불러오기 실패:",e)}}static getLogCount(){return this.logs.length}}"undefined"!=typeof window&&t4.loadFromStorage();class t8{async createPeer(e){return t4.info("PeerManager","Peer 생성 시작",{customId:e}),new Promise((t,i)=>{try{this.peer=new t6(e,{host:"0.peerjs.com",port:443,path:"/",secure:!0,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}}),this.peer.on("open",e=>{t4.info("PeerManager","Peer 생성 완료",{peerId:e}),console.log("[PeerManager] Peer 생성 완료:",e),this.reconnectAttempts=0,this.emit("open",e),t(e)}),this.peer.on("connection",e=>{t4.info("PeerManager","새 연결 수신",{peerId:e.peer}),console.log("[PeerManager] 새 연결 수신:",e.peer),this.handleConnection(e),this.emit("connection",e)}),this.peer.on("disconnected",()=>{t4.warn("PeerManager","Peer 서버 연결 끊김"),console.warn("[PeerManager] Peer 서버 연결 끊김"),this.emit("disconnected"),this.attemptReconnect()}),this.peer.on("error",e=>{t4.error("PeerManager","Peer 에러",e),console.error("[PeerManager] Peer 에러:",e),this.emit("error",e),e.message.includes("ID is taken")&&i(Error("이미 사용 중인 방 코드입니다."))})}catch(e){i(e)}})}async connectToHost(e,t=3){t4.info("PeerManager","호스트 연결 시도 시작",{hostId:e,maxRetries:t});for(let i=1;i<=t;i++)try{t4.info("PeerManager",`\u{C5F0}\u{ACB0} \u{C2DC}\u{B3C4} ${i}/${t}`,{hostId:e}),this.emit("connectionProgress",`\u{BC29}\u{C5D0} \u{C5F0}\u{ACB0} \u{C911}... (${i}/${t})`);let s=await this.attemptConnection(e,3e4);return t4.info("PeerManager","호스트 연결 성공",{hostId:e,attempt:i}),s}catch(o){if(t4.warn("PeerManager",`\u{C5F0}\u{ACB0} \u{C2DC}\u{B3C4} ${i} \u{C2E4}\u{D328}`,{hostId:e,error:o.message}),i===t)throw t4.error("PeerManager","모든 연결 시도 실패",o),o;let s=2e3*i;t4.info("PeerManager",`${s}ms \u{D6C4} \u{C7AC}\u{C2DC}\u{B3C4}`,{attempt:i}),this.emit("connectionProgress",`\u{C7AC}\u{C5F0}\u{ACB0} \u{C911}... (${i+1}/${t})`),await this.delay(s)}throw Error("연결 실패")}attemptConnection(e,t){return new Promise((i,s)=>{if(!this.peer)return void s(Error("Peer가 생성되지 않았습니다."));try{let o=this.peer.connect(e,{reliable:!0,serialization:"json"});o.on("open",()=>{t4.info("PeerManager","호스트 연결 수립 완료",{hostId:e}),console.log("[PeerManager] 호스트 연결 성공:",e),this.handleConnection(o),i(o)}),o.on("error",e=>{t4.error("PeerManager","연결 에러",e),console.error("[PeerManager] 연결 실패:",e),s(e)}),setTimeout(()=>{if(!o.open){let i=Error(`\u{C5F0}\u{ACB0} \u{C2DC}\u{AC04} \u{CD08}\u{ACFC} (${t}ms)`);t4.warn("PeerManager","연결 타임아웃",{hostId:e,timeout:t}),s(i)}},t)}catch(e){s(e)}})}delay(e){return new Promise(t=>setTimeout(t,e))}handleConnection(e){this.connections.set(e.peer,e),e.on("data",t=>{try{console.log("[PeerManager] 데이터 수신:",t.type,"from",e.peer),this.emit("data",t,e)}catch(e){console.error("[PeerManager] 데이터 파싱 실패:",e)}}),e.on("close",()=>{console.log("[PeerManager] 연결 종료:",e.peer),this.connections.delete(e.peer),this.emit("close",e)}),e.on("error",e=>{console.error("[PeerManager] 연결 에러:",e),this.emit("error",e)})}send(e,t){let i=this.connections.get(e);if(i&&i.open)try{i.send(t),console.log("[PeerManager] 메시지 전송:",t.type,"to",e)}catch(e){console.error("[PeerManager] 메시지 전송 실패:",e)}else console.warn("[PeerManager] 연결을 찾을 수 없음:",e)}broadcast(e,t){console.log("[PeerManager] 메시지 브로드캐스트:",e.type,"(",this.connections.size,"명)"),this.connections.forEach((i,s)=>{if(s!==t&&i.open)try{i.send(e)}catch(e){console.error("[PeerManager] 브로드캐스트 실패:",s,e)}})}disconnect(e){let t=this.connections.get(e);t&&(t.close(),this.connections.delete(e),console.log("[PeerManager] 연결 종료:",e))}disconnectAll(){console.log("[PeerManager] 모든 연결 종료"),this.connections.forEach(e=>{e.close()}),this.connections.clear()}destroy(){console.log("[PeerManager] Peer 종료"),this.disconnectAll(),this.peer&&(this.peer.destroy(),this.peer=null),this.eventHandlers.clear()}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("[PeerManager] 최대 재연결 시도 횟수 초과"),this.emit("error",Error("서버 연결 실패"));return}this.reconnectAttempts++,console.log(`[PeerManager] \u{C7AC}\u{C5F0}\u{ACB0} \u{C2DC}\u{B3C4} (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.peer&&!this.peer.destroyed&&setTimeout(()=>{this.peer?.reconnect()},1e3*this.reconnectAttempts)}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}emit(e,...t){let i=this.eventHandlers.get(e);i&&i.forEach(i=>{try{i(...t)}catch(t){console.error(`[PeerManager] \u{C774}\u{BCA4}\u{D2B8} \u{D578}\u{B4E4}\u{B7EC} \u{C5D0}\u{B7EC} (${e}):`,t)}})}getPeerId(){return this.peer?.id||null}getConnectionCount(){return this.connections.size}getConnectedPeerIds(){return Array.from(this.connections.keys())}isConnected(e){let t=this.connections.get(e);return!!t&&t.open}constructor(){this.peer=null,this.connections=new Map,this.eventHandlers=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5}}var t7=((d={}).JOIN_REQUEST="JOIN_REQUEST",d.JOIN_ACCEPT="JOIN_ACCEPT",d.JOIN_REJECT="JOIN_REJECT",d.PLAYER_JOINED="PLAYER_JOINED",d.PLAYER_LEFT="PLAYER_LEFT",d.PLAYER_LIST="PLAYER_LIST",d.READY_STATE="READY_STATE",d.NAME_CHANGE="NAME_CHANGE",d.GAME_CONFIG="GAME_CONFIG",d.MAP_CHANGE="MAP_CHANGE",d.START_GAME="START_GAME",d.GAME_STATE="GAME_STATE",d.GAME_END="GAME_END",d.PAUSE_GAME="PAUSE_GAME",d.RESUME_GAME="RESUME_GAME",d.FAST_FORWARD="FAST_FORWARD",d.KICK_PLAYER="KICK_PLAYER",d.CHAT_MESSAGE="CHAT_MESSAGE",d.ERROR="ERROR",d);class t9{static createBase(e,t){return{type:e,timestamp:Date.now(),senderId:t}}static createJoinRequest(e,t){return{...this.createBase("JOIN_REQUEST",e),type:"JOIN_REQUEST",payload:{playerName:t}}}static createJoinAccept(e,t,i,s){return{...this.createBase("JOIN_ACCEPT",e),type:"JOIN_ACCEPT",payload:{roomId:t,players:i,gameConfig:s}}}static createStartGame(e,t){return{...this.createBase("START_GAME",e),type:"START_GAME",payload:{config:t,startTime:Date.now()}}}static createReadyState(e,t,i){return{...this.createBase("READY_STATE",e),type:"READY_STATE",payload:{playerId:t,isReady:i}}}static createNameChange(e,t,i){return{...this.createBase("NAME_CHANGE",e),type:"NAME_CHANGE",payload:{playerId:t,newName:i}}}static createGameConfig(e,t){return{...this.createBase("GAME_CONFIG",e),type:"GAME_CONFIG",payload:{config:t}}}static createError(e,t,i){return{...this.createBase("ERROR",e),type:"ERROR",payload:{code:t,message:i}}}}class ie{constructor(e){this.roomId=null,this.isHost=!1,this.players=new Map,this.currentGameConfig=null,this.eventHandlers={},this.hostConnection=null,this.peerManager=e,this.setupPeerManagerEvents()}setupPeerManagerEvents(){this.peerManager.on("open",e=>{console.log("[RoomManager] Peer 생성 완료:",e)}),this.peerManager.on("connection",e=>{console.log("[RoomManager] 새 연결 수신:",e.peer)}),this.peerManager.on("data",(e,t)=>{this.handleMessage(e,t)}),this.peerManager.on("close",e=>{this.handlePlayerLeft(e.peer)}),this.peerManager.on("error",e=>{console.error("[RoomManager] 에러:",e)})}async createRoom(e,t){try{let i=t||this.generateRoomCode(),s=await this.peerManager.createPeer(i);this.roomId=i,this.isHost=!0;let o={id:s,name:e,isHost:!0,isReady:!0,joinedAt:Date.now()};return this.players.set(s,o),console.log("[RoomManager] 룸 생성 완료:",i),i}catch(e){throw console.error("[RoomManager] 룸 생성 실패:",e),e}}async joinRoom(e,t){try{let i=await this.peerManager.createPeer(),s=await this.peerManager.connectToHost(t);this.hostConnection=s,this.roomId=t,this.isHost=!1;let o=t9.createJoinRequest(i,e);return this.peerManager.send(t,o),new Promise((e,t)=>{let i=setTimeout(()=>{t(Error("참가 응답 시간 초과"))},1e4),s=this.eventHandlers.playerJoined;this.eventHandlers.playerJoined=t=>{clearTimeout(i),this.eventHandlers.playerJoined=s,e(Array.from(this.players.values()))}})}catch(e){throw console.error("[RoomManager] 룸 참가 실패:",e),e}}handleMessage(e,t){switch(console.log("[RoomManager] 메시지 수신:",e.type),e.type){case t7.JOIN_REQUEST:this.handleJoinRequest(e,t);break;case t7.JOIN_ACCEPT:this.handleJoinAccept(e);break;case t7.PLAYER_JOINED:this.handlePlayerJoined(e);break;case t7.PLAYER_LEFT:this.handlePlayerLeft(e.payload.playerId);break;case t7.PLAYER_LIST:this.handlePlayerList(e);break;case t7.READY_STATE:this.handleReadyState(e);break;case t7.NAME_CHANGE:this.handleNameChange(e);break;case t7.GAME_CONFIG:this.handleGameConfig(e);break;case t7.KICK_PLAYER:this.handleKickPlayer(e);break;default:console.warn("[RoomManager] 처리되지 않은 메시지 타입:",e.type)}}handleJoinRequest(e,t){if(!this.isHost)return;let{playerName:i}=e.payload,s=e.senderId;console.log("[RoomManager] 참가 요청:",i,s);let o={id:s,name:i,isHost:!1,isReady:!1,joinedAt:Date.now()};this.players.set(s,o);let r=t9.createJoinAccept(this.peerManager.getPeerId(),this.roomId,Array.from(this.players.values()),this.currentGameConfig||void 0);this.peerManager.send(s,r);let n={type:t7.PLAYER_JOINED,timestamp:Date.now(),senderId:this.peerManager.getPeerId(),payload:{player:o}};this.peerManager.broadcast(n,s),this.emit("playerJoined",o)}handleJoinAccept(e){if(this.isHost)return;let{players:t,gameConfig:i}=e.payload;console.log("[RoomManager] 참가 수락:",t.length,"명"),this.players.clear(),t.forEach(e=>{this.players.set(e.id,e)}),i&&(this.currentGameConfig=i,this.emit("gameConfigChanged",i));let s=t.find(e=>e.id===this.peerManager.getPeerId());s&&this.emit("playerJoined",s)}handlePlayerJoined(e){if(this.isHost)return;let{player:t}=e.payload;console.log("[RoomManager] 새 참가자 입장:",t.name),this.players.set(t.id,t),this.emit("playerJoined",t)}handlePlayerLeft(e){let t=this.players.get(e);if(t){if(console.log("[RoomManager] 참가자 퇴장:",t.name),this.players.delete(e),this.isHost){let t={type:t7.PLAYER_LEFT,timestamp:Date.now(),senderId:this.peerManager.getPeerId(),payload:{playerId:e}};this.peerManager.broadcast(t)}this.emit("playerLeft",e)}}handlePlayerList(e){let{players:t}=e.payload;console.log("[RoomManager] 참가자 목록 업데이트:",t.length,"명"),this.players.clear(),t.forEach(e=>{this.players.set(e.id,e)})}handleReadyState(e){let{playerId:t,isReady:i}=e.payload,s=this.players.get(t);s&&(s.isReady=i,console.log("[RoomManager] 준비 상태 변경:",s.name,i),this.emit("playerReady",t,i),this.isHost&&this.areAllPlayersReady()&&this.emit("allReady"))}handleNameChange(e){let{playerId:t,newName:i}=e.payload,s=this.players.get(t);s&&(s.name=i,console.log("[RoomManager] 이름 변경:",t,"→",i),this.isHost&&this.peerManager.broadcast(e,t),this.emit("playerJoined",s))}handleGameConfig(e){let{config:t}=e.payload;console.log("[RoomManager] 게임 설정 변경"),this.currentGameConfig=t,this.emit("gameConfigChanged",t)}handleKickPlayer(e){let{playerId:t}=e.payload;t===this.peerManager.getPeerId()?(console.log("[RoomManager] 강퇴당함"),this.leaveRoom(),alert("호스트에 의해 강퇴되었습니다.")):this.isHost&&(this.peerManager.disconnect(t),this.handlePlayerLeft(t))}toggleReady(){if(this.isHost)return void console.warn("[RoomManager] 호스트는 준비 상태를 변경할 수 없습니다.");let e=this.players.get(this.peerManager.getPeerId());if(!e)return;let t=!e.isReady;e.isReady=t;let i=t9.createReadyState(this.peerManager.getPeerId(),this.peerManager.getPeerId(),t);this.peerManager.send(this.roomId,i),this.emit("playerReady",e.id,t)}async changePlayerName(e){let t=this.peerManager.getPeerId();if(!t)throw Error("Peer가 초기화되지 않았습니다.");let i=this.players.get(t);if(!i)throw Error("플레이어 정보를 찾을 수 없습니다.");i.name=e;let s=t9.createNameChange(t,t,e);this.isHost?this.peerManager.broadcast(s):this.peerManager.send(this.roomId,s),console.log("[RoomManager] 이름 변경:",e)}updateGameConfig(e){if(!this.isHost)return void console.warn("[RoomManager] 호스트만 게임 설정을 변경할 수 있습니다.");this.currentGameConfig=e;let t=t9.createGameConfig(this.peerManager.getPeerId(),e);this.peerManager.broadcast(t),this.emit("gameConfigChanged",e)}kickPlayer(e){if(!this.isHost)return void console.warn("[RoomManager] 호스트만 참가자를 강퇴할 수 있습니다.");let t={type:t7.KICK_PLAYER,timestamp:Date.now(),senderId:this.peerManager.getPeerId(),payload:{playerId:e}};this.peerManager.send(e,t),this.peerManager.disconnect(e),this.handlePlayerLeft(e)}leaveRoom(){console.log("[RoomManager] 룸 나가기"),this.isHost?this.peerManager.disconnectAll():this.hostConnection&&this.hostConnection.close(),this.players.clear(),this.roomId=null,this.isHost=!1,this.currentGameConfig=null}generateRoomCode(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let i=0;i<6;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}areAllPlayersReady(){if(this.players.size<=1)return!1;for(let e of this.players.values())if(!e.isReady)return!1;return!0}on(e,t){this.eventHandlers[e]=t}emit(e,...t){let i=this.eventHandlers[e];i&&i(...t)}getRoomId(){return this.roomId}getIsHost(){return this.isHost}getPlayers(){return Array.from(this.players.values())}getPlayerCount(){return this.players.size}getCurrentGameConfig(){return this.currentGameConfig}getMyPlayer(){let e=this.peerManager.getPeerId();return e&&this.players.get(e)||null}}class it{constructor(e,t){this.eventHandlers={},this.currentGameState=null,this.syncInterval=null,this.syncRate=100,this.peerManager=e,this.roomManager=t,this.setupPeerManagerEvents()}setupPeerManagerEvents(){this.peerManager.on("data",e=>{this.handleMessage(e)})}handleMessage(e){switch(e.type){case t7.START_GAME:this.handleStartGame(e);break;case t7.GAME_STATE:this.handleGameState(e);break;case t7.GAME_END:this.handleGameEnd(e);break;case t7.PAUSE_GAME:this.emit("gamePause");break;case t7.RESUME_GAME:this.emit("gameResume");break;case t7.FAST_FORWARD:this.handleFastForward(e)}}handleStartGame(e){if(this.roomManager.getIsHost())return;let{config:t,startTime:i}=e.payload;console.log("[GameSync] 게임 시작 신호 수신"),setTimeout(()=>{this.emit("gameStart",t)},Math.max(0,i-Date.now()))}handleGameState(e){if(this.roomManager.getIsHost())return;let{state:t}=e.payload;this.currentGameState=t,this.emit("stateUpdate",t)}handleGameEnd(e){let{winners:t,results:i}=e.payload;console.log("[GameSync] 게임 종료:",t),this.stopSync(),this.emit("gameEnd",t,i)}startGame(e,t,i){if(!this.roomManager.getIsHost())return void console.warn("[GameSync] 호스트만 게임을 시작할 수 있습니다.");let s={marbles:e.map(e=>this.parseMarbleName(e)),mapIndex:t,winnerRank:i,randomSeed:Date.now()};this.roomManager.updateGameConfig(s);let o=t9.createStartGame(this.peerManager.getPeerId(),s);this.peerManager.broadcast(o),setTimeout(()=>{this.emit("gameStart",s)},100),this.startSync()}parseMarbleName(e){let t=e,i=1,s=1,o=e.match(/\/(\d+)/);o&&(i=parseFloat(o[1]),t=t.replace(/\/\d+/,""));let r=e.match(/\*(\d+)/);return r&&(s=parseInt(r[1]),t=t.replace(/\*\d+/,"")),{name:t.trim(),weight:i,count:s}}startSync(){this.roomManager.getIsHost()&&(this.stopSync(),console.log("[GameSync] 상태 동기화 시작"),this.syncInterval=window.setInterval(()=>{if(this.currentGameState){let e={type:t7.GAME_STATE,timestamp:Date.now(),senderId:this.peerManager.getPeerId(),payload:{state:this.currentGameState}};this.peerManager.broadcast(e)}},this.syncRate))}stopSync(){null!==this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null,console.log("[GameSync] 상태 동기화 중지"))}updateGameState(e){this.roomManager.getIsHost()&&(this.currentGameState=e)}endGame(e,t){if(!this.roomManager.getIsHost())return void console.warn("[GameSync] 호스트만 게임을 종료할 수 있습니다.");console.log("[GameSync] 게임 종료 브로드캐스트");let i={type:t7.GAME_END,timestamp:Date.now(),senderId:this.peerManager.getPeerId(),payload:{winners:e,results:t}};this.peerManager.broadcast(i),this.stopSync(),this.emit("gameEnd",e,t)}pauseGame(){if(!this.roomManager.getIsHost())return void console.warn("[GameSync] 호스트만 게임을 일시정지할 수 있습니다.");let e={type:t7.PAUSE_GAME,timestamp:Date.now(),senderId:this.peerManager.getPeerId(),payload:{}};this.peerManager.broadcast(e),this.emit("gamePause")}resumeGame(){if(!this.roomManager.getIsHost())return void console.warn("[GameSync] 호스트만 게임을 재개할 수 있습니다.");let e={type:t7.RESUME_GAME,timestamp:Date.now(),senderId:this.peerManager.getPeerId(),payload:{}};this.peerManager.broadcast(e),this.emit("gameResume")}handleFastForward(e){if(this.roomManager.getIsHost())return;let{isEnabled:t}=e.payload;console.log("[GameSync] 빨리감기 상태:",t),this.emit("fastForward",t)}setFastForward(e){if(!this.roomManager.getIsHost())return void console.warn("[GameSync] 호스트만 빨리감기를 제어할 수 있습니다.");let t={type:t7.FAST_FORWARD,timestamp:Date.now(),senderId:this.peerManager.getPeerId(),payload:{isEnabled:e}};this.peerManager.broadcast(t)}setSyncRate(e){this.syncRate=e,null!==this.syncInterval&&(this.stopSync(),this.startSync())}destroy(){this.stopSync(),this.eventHandlers={}}on(e,t){this.eventHandlers[e]=t}emit(e,...t){let i=this.eventHandlers[e];i&&i(...t)}getCurrentGameState(){return this.currentGameState}getIsHost(){return this.roomManager.getIsHost()}}"serviceWorker"in navigator&&window.addEventListener("load",()=>{let e=`${window.location.origin}/roulette/service-worker.js`;navigator.serviceWorker.register(e).then(e=>console.log("service worker registered",e.scope)).catch(e=>console.error("service worker registration failed",e))});const ii=new J,is=new class{constructor(){this.isInitialized=!1,this.peerManager=new t8,this.roomManager=new ie(this.peerManager),this.gameSync=new it(this.peerManager,this.roomManager),this.setupRoomManagerEvents(),this.setupGameSyncEvents()}init(){this.isInitialized||(console.log("[MultiplayerUI] 초기화"),this.setupUI(),this.isInitialized=!0)}setupUI(){let e=document.getElementById("mp-create-room-btn");e&&e.addEventListener("click",()=>this.showCreateRoomModal());let t=document.getElementById("mp-join-room-btn");t&&t.addEventListener("click",()=>this.showJoinRoomModal());let i=document.getElementById("mp-ready-btn");i&&i.addEventListener("click",()=>this.toggleReady());let s=document.getElementById("mp-leave-room-btn");s&&s.addEventListener("click",()=>this.leaveRoom());let o=document.getElementById("mp-change-name-btn");o&&o.addEventListener("click",()=>this.showChangeNameModal())}setupRoomManagerEvents(){this.roomManager.on("playerJoined",e=>{this.updatePlayerList()}),this.roomManager.on("playerLeft",e=>{this.updatePlayerList()}),this.roomManager.on("playerReady",(e,t)=>{this.updatePlayerList()}),this.roomManager.on("allReady",()=>{this.onAllPlayersReady()})}setupGameSyncEvents(){this.gameSync.on("gameStart",e=>{console.log("[MultiplayerUI] 게임 시작 신호 수신");let t=[];e.marbles.forEach(e=>{let i=e.count||1,s=e.weight||1,o=e.name;s>1&&(o+=`/${s}`);for(let e=0;e<i;e++)t.push(o)}),window.roulette.setMarbles(t),window.roulette.setMap(e.mapIndex),window.options.winningRank=e.winnerRank,window.roulette.setWinningRank(e.winnerRank),e.randomSeed&&window.roulette.setRandomSeed(e.randomSeed),window.roulette.start(),document.querySelector("#settings")?.classList.add("hide")}),this.gameSync.on("gameEnd",(e,t)=>{if(this.roomManager.getIsHost())return;console.log("[MultiplayerUI] 호스트로부터 게임 종료 수신:",e);let i=window.roulette;i._isRunning=!1,i.dispatchEvent(new CustomEvent("goal",{detail:{winner:e[0]}})),i._particleManager.shot(i._renderer.width,i._renderer.height)}),this.gameSync.on("fastForward",e=>{this.roomManager.getIsHost()||(console.log("[MultiplayerUI] 호스트 빨리감기 상태:",e),window.roulette.getFastForwarder().setEnabled(e))})}showCreateRoomModal(){let e=document.getElementById("mp-modal"),t=document.getElementById("mp-modal-title"),i=document.getElementById("mp-modal-content");e&&t&&i&&(t.textContent="방 만들기",i.innerHTML=`
      <div class="mp-modal-form">
        <label>
          \u{C774}\u{B984}:
          <input type="text" id="mp-player-name" placeholder="\u{C774}\u{B984}\u{C744} \u{C785}\u{B825}\u{D558}\u{C138}\u{C694}" maxlength="20" />
        </label>
        <button id="mp-create-btn" class="mp-btn-primary">\u{BC29} \u{B9CC}\u{B4E4}\u{AE30}</button>
        <button id="mp-cancel-btn" class="mp-btn-secondary">\u{CDE8}\u{C18C}</button>
      </div>
    `,e.style.display="flex",document.getElementById("mp-create-btn")?.addEventListener("click",async()=>{let t=document.getElementById("mp-player-name"),i=t?.value.trim();if(!i)return void alert("이름을 입력해주세요.");try{let t=await this.roomManager.createRoom(i);this.onRoomCreated(t),e.style.display="none"}catch(e){alert("방 생성 실패: "+e.message)}}),document.getElementById("mp-cancel-btn")?.addEventListener("click",()=>{e.style.display="none"}))}showJoinRoomModal(){let e=document.getElementById("mp-modal"),t=document.getElementById("mp-modal-title"),i=document.getElementById("mp-modal-content");if(!e||!t||!i)return;t.textContent="방 참가하기",i.innerHTML=`
      <div class="mp-modal-form">
        <label>
          \u{BC29} \u{CF54}\u{B4DC}:
          <input type="text" id="mp-room-code" placeholder="6\u{C790}\u{B9AC} \u{BC29} \u{CF54}\u{B4DC}" maxlength="6" style="text-transform: uppercase;" autofocus />
        </label>
        <label>
          \u{C774}\u{B984} (\u{C120}\u{D0DD}):
          <input type="text" id="mp-player-name" placeholder="\u{C774}\u{B984} \u{BBF8}\u{C785}\u{B825} \u{C2DC} '\u{AC8C}\u{C2A4}\u{D2B8}'\u{B85C} \u{D45C}\u{C2DC}" maxlength="20" />
        </label>
        <button id="mp-join-btn" class="mp-btn-primary">\u{CC38}\u{AC00}\u{D558}\u{AE30}</button>
        <button id="mp-cancel-btn" class="mp-btn-secondary">\u{CDE8}\u{C18C}</button>
      </div>
    `,e.style.display="flex";let s=document.getElementById("mp-room-code");s?.addEventListener("keypress",e=>{"Enter"===e.key&&document.getElementById("mp-join-btn")?.click()});let o=document.getElementById("mp-player-name");o?.addEventListener("keypress",e=>{"Enter"===e.key&&document.getElementById("mp-join-btn")?.click()}),document.getElementById("mp-join-btn")?.addEventListener("click",async()=>{let t=o?.value.trim()||"게스트",i=s?.value.trim().toUpperCase();if(!i||6!==i.length)return void alert("올바른 방 코드를 입력해주세요.");t4.info("MultiplayerUI","방 참가 시도",{playerName:t,roomCode:i}),this.showLoadingUI("방에 연결 중...","호스트를 찾고 있습니다.");let r=e=>{this.updateLoadingMessage(e)};this.peerManager.on("connectionProgress",r);try{await this.roomManager.joinRoom(t,i),t4.info("MultiplayerUI","방 참가 성공",{roomCode:i}),this.onRoomJoined(i),e.style.display="none"}catch(e){t4.error("MultiplayerUI","방 참가 실패",e),this.showErrorUI("방 참가 실패",e.message,()=>this.showJoinRoomModal())}}),document.getElementById("mp-cancel-btn")?.addEventListener("click",()=>{e.style.display="none"})}showChangeNameModal(){let e=document.getElementById("mp-modal"),t=document.getElementById("mp-modal-title"),i=document.getElementById("mp-modal-content");if(!e||!t||!i)return;let s=this.roomManager.getMyPlayer();if(!s)return;t.textContent="이름 변경",i.innerHTML=`
      <div class="mp-modal-form">
        <label>
          \u{C0C8} \u{C774}\u{B984}:
          <input type="text" id="mp-new-name" placeholder="\u{C0C8} \u{C774}\u{B984}\u{C744} \u{C785}\u{B825}\u{D558}\u{C138}\u{C694}" maxlength="20" value="${s.name}" autofocus />
        </label>
        <button id="mp-change-name-confirm-btn" class="mp-btn-primary">\u{BCC0}\u{ACBD}</button>
        <button id="mp-cancel-btn" class="mp-btn-secondary">\u{CDE8}\u{C18C}</button>
      </div>
    `,e.style.display="flex";let o=document.getElementById("mp-new-name");o?.addEventListener("keypress",e=>{"Enter"===e.key&&document.getElementById("mp-change-name-confirm-btn")?.click()}),setTimeout(()=>{o?.select()},100),document.getElementById("mp-change-name-confirm-btn")?.addEventListener("click",async()=>{let t=o?.value.trim()||"게스트";if(t===s.name){e.style.display="none";return}try{await this.roomManager.changePlayerName(t),e.style.display="none",this.updatePlayerList()}catch(e){alert("이름 변경 실패: "+e.message)}}),document.getElementById("mp-cancel-btn")?.addEventListener("click",()=>{e.style.display="none"})}onRoomCreated(e){console.log("[MultiplayerUI] 방 생성 완료:",e);let t=document.getElementById("mp-room-panel");t&&(t.style.display="block");let i=document.getElementById("mp-room-code-display");i&&(i.textContent=e);let s=document.getElementById("mp-copy-room-code");s&&(s.onclick=()=>{navigator.clipboard.writeText(e),alert("방 코드가 복사되었습니다!")}),this.updatePlayerList(),this.hideMainMenuButtons(),this.showRoomButtons(!0),this.hideMarbleInput()}onRoomJoined(e){console.log("[MultiplayerUI] 방 참가 완료:",e);let t=document.getElementById("mp-room-panel");t&&(t.style.display="block");let i=document.getElementById("mp-room-code-display");i&&(i.textContent=e),this.updatePlayerList(),this.hideMainMenuButtons(),this.showRoomButtons(!1),this.hideMarbleInput()}updatePlayerList(){let e=document.getElementById("mp-player-list");if(!e)return;let t=this.roomManager.getPlayers(),i=this.roomManager.getMyPlayer();e.innerHTML=t.map(e=>{let t=e.isHost?'<span class="mp-badge-host">\uD83D\uDC51</span>':"",s=e.isReady?'<span class="mp-badge-ready">\uD83D\uDFE2</span>':'<span class="mp-badge-not-ready">\uD83D\uDD34</span>',o=e.id===i?.id?'<span class="mp-badge-me">(나)</span>':"";return`
          <div class="mp-player-item">
            <span class="mp-player-name">${t} ${e.name} ${o}</span>
            <span class="mp-player-status">${s}</span>
          </div>
        `}).join(""),this.updateReadyButton()}updateReadyButton(){let e=document.getElementById("mp-ready-btn");if(!e)return;let t=this.roomManager.getMyPlayer();if(!t||t.isHost){e.style.display="none";return}e.style.display="block",e.textContent=t.isReady?"준비 취소":"준비",e.className=t.isReady?"mp-btn-secondary":"mp-btn-primary"}toggleReady(){this.roomManager.toggleReady()}onAllPlayersReady(){if(console.log("[MultiplayerUI] 모든 참가자 준비 완료"),this.roomManager.getIsHost()){let e=document.getElementById("start");e&&(e.removeAttribute("disabled"),e.style.opacity="1",e.style.cursor="pointer")}}leaveRoom(){if(confirm("정말 방을 나가시겠습니까?")){this.roomManager.leaveRoom();let e=document.getElementById("mp-room-panel");e&&(e.style.display="none"),this.showMainMenuButtons(),this.hideRoomButtons(),this.showMarbleInput()}}hideMainMenuButtons(){let e=document.getElementById("mp-create-room-btn"),t=document.getElementById("mp-join-room-btn");e&&(e.style.display="none"),t&&(t.style.display="none")}showMainMenuButtons(){let e=document.getElementById("mp-create-room-btn"),t=document.getElementById("mp-join-room-btn");e&&(e.style.display="block"),t&&(t.style.display="block")}showRoomButtons(e){let t=document.getElementById("mp-ready-btn"),i=document.getElementById("mp-leave-room-btn");t&&(t.style.display=e?"none":"block"),i&&(i.style.display="block")}hideRoomButtons(){let e=document.getElementById("mp-ready-btn"),t=document.getElementById("mp-leave-room-btn");e&&(e.style.display="none"),t&&(t.style.display="none")}hideMarbleInput(){let e=document.querySelector(".left");e&&(e.style.display="none");let t=document.getElementById("mp-room-panel");if(t&&!document.getElementById("mp-marble-info")){let e=document.createElement("div");e.id="mp-marble-info",e.style.cssText="padding: 10px; margin: 10px 0; background: rgba(255, 255, 255, 0.1); border-radius: 8px; text-align: center;",e.innerHTML='<p style="margin: 0; color: #fff;">✨ 참가자 이름으로 게임이 진행됩니다</p>',t.appendChild(e)}}showMarbleInput(){let e=document.querySelector(".left");e&&(e.style.display="block");let t=document.getElementById("mp-marble-info");t&&t.remove()}showLoadingUI(e,t){let i=document.getElementById("mp-modal"),s=document.getElementById("mp-modal-title"),o=document.getElementById("mp-modal-content");i&&s&&o&&(s.textContent=e,o.innerHTML=`
      <div class="mp-loading">
        <div class="mp-spinner"></div>
        <p id="mp-loading-message" class="mp-loading-message">${t}</p>
      </div>
    `,i.style.display="flex")}updateLoadingMessage(e){let t=document.getElementById("mp-loading-message");t&&(t.textContent=e,t4.debug("MultiplayerUI","로딩 메시지 업데이트",{message:e}))}showErrorUI(e,t,i){let s=document.getElementById("mp-modal"),o=document.getElementById("mp-modal-title"),r=document.getElementById("mp-modal-content");s&&o&&r&&(o.textContent=e,r.innerHTML=`
      <div class="mp-error">
        <p class="mp-error-message">\u{274C} ${t}</p>
        <div class="mp-error-actions">
          ${i?'<button id="mp-retry-btn" class="mp-btn-primary">다시 시도</button>':""}
          <button id="mp-error-close-btn" class="mp-btn-secondary">\u{B2EB}\u{AE30}</button>
        </div>
        <div class="mp-error-logs">
          <button id="mp-download-logs-btn" class="mp-btn-small">\u{B85C}\u{ADF8} \u{B2E4}\u{C6B4}\u{B85C}\u{B4DC}</button>
        </div>
      </div>
    `,s.style.display="flex",i&&document.getElementById("mp-retry-btn")?.addEventListener("click",()=>{s.style.display="none",i()}),document.getElementById("mp-error-close-btn")?.addEventListener("click",()=>{s.style.display="none"}),document.getElementById("mp-download-logs-btn")?.addEventListener("click",()=>{t4.downloadLogs()}))}getPeerManager(){return this.peerManager}getRoomManager(){return this.roomManager}getGameSync(){return this.gameSync}};document.addEventListener("DOMContentLoaded",()=>{is.init()}),window.roulette=ii,window.options=R,window.multiplayerUI=is;
//# sourceMappingURL=roulette.dae224e5.js.map
